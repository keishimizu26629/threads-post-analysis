<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ã‚¹ãƒ¬ãƒƒã‚ºåˆ†æãƒ„ãƒ¼ãƒ« UIã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆæœ€çµ‚ç‰ˆãƒ»æ”¹ï¼‰</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background-color: #f0f2f5;
        color: #333;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: none;
        width: 100%;
        margin: 0 auto;
        background-color: #fff;
        border: 1px solid #ccc;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border-radius: 8px;
        overflow: hidden;
      }

      /* ã‚·ãƒ¼ãƒˆã®ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ */
      .sheet-tabs {
        display: flex;
        background-color: #f9f9f9;
        border-bottom: 2px solid #1a73e8;
        padding-left: 15px;
      }
      .tab {
        padding: 10px 18px;
        cursor: pointer;
        border: 1px solid transparent;
        border-bottom: none;
        user-select: none;
        color: #5f6368;
        font-weight: 500;
      }
      .tab.active {
        background-color: #fff;
        color: #1a73e8;
        border-top: 2px solid #1a73e8;
        border-left: 1px solid #ccc;
        border-right: 1px solid #ccc;
        border-radius: 6px 6px 0 0;
        position: relative;
        bottom: -2px;
        z-index: 2;
      }
      .tab:not(.active):hover {
        background-color: #eee;
      }

      /* ã‚·ãƒ¼ãƒˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
      .sheet-content {
        display: none;
        padding: 15px;
      }
      .sheet-content.active {
        display: block;
      }

      /* --- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« (è¡Œåˆ—å…¥æ›¿) --- */
      .spreadsheet {
        width: 100%;
        max-width: none;
        table-layout: fixed;
        border-collapse: collapse;
        overflow-x: auto;
        display: block;
      }
      .spreadsheet th,
      .spreadsheet td {
        border: 1px solid #d9d9d9;
        padding: 8px 10px;
        min-width: 150px; /* åˆ—ã®æœ€å°å¹… */
        font-size: 13px;
        text-align: right; /* æ•°å€¤ã¯å³å¯„ã› */
      }

      /* æ—¥ä»˜ã‚«ãƒ©ãƒ ï¼ˆ80pxå›ºå®šå¹…ï¼‰ */
      .date-column {
        width: 80px;
        min-width: 80px;
        max-width: 80px;
        text-align: center;
        font-size: 12px;
        padding: 8px 4px;
      }

      .date-column br {
        line-height: 1.2;
      }

      .day-of-week {
        font-size: 10px;
        color: #6c757d;
        font-weight: normal;
      }

      /* ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¨ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ */
      .data-cell:empty::before,
      .data-cell[data-value='']:before {
        content: '-';
        color: #ccc;
        font-style: italic;
      }

      .loading .data-cell::before {
        content: 'èª­ã¿è¾¼ã¿ä¸­...';
        color: #666;
      }

      /* ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ (æ¨ªåˆ—) */
      .spreadsheet thead th {
        text-align: center;
        background-color: #f4f4f4;
        color: #333;
        font-weight: bold;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      /* ãƒ˜ãƒƒãƒ€ãƒ¼åˆ— (ç¸¦åˆ—) - ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ  */
      .spreadsheet tbody th {
        text-align: left;
        background-color: #f4f4f4;
        color: #333;
        font-weight: bold;
        position: sticky;
        left: 0;
        z-index: 5;
        min-width: 180px; /* é …ç›®åã¯é•·ã‚ */
        box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
      }

      /* ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
      .sticky-column {
        position: sticky;
        left: 0;
        background-color: #f4f4f4;
        z-index: 10;
        min-width: 180px;
        box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
      }

      /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®å½±åŠ¹æœå¼·åŒ– */
      .sticky-column.scrolled {
        box-shadow: 4px 0 8px rgba(0, 0, 0, 0.15);
      }

      /* æŠ•ç¨¿æ–‡ã®è¡Œ */
      .spreadsheet .post-text-row th,
      .spreadsheet .post-text-row td {
        min-height: 150px;
        white-space: pre-wrap;
        word-break: break-all;
        vertical-align: top;
        text-align: left;
      }

      /* --- NEW: æ™‚é–“ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ˜ãƒƒãƒ€ãƒ¼ --- */
      .time-header-row th {
        text-align: left;
        background-color: #e8f0fe; /* GSheetã®ãƒ•ãƒªãƒ¼ã‚ºè¡Œã£ã½ã„è‰² */
        color: #1a73e8;
        font-weight: bold;
        font-size: 14px;
        position: sticky;
        left: 0;
        z-index: 6;
      }

      /* --- NEW: ç©ºç™½è¡Œ (åŒºåˆ‡ã‚Šç·š) --- */
      .spacer-row td {
        height: 10px;
        border: none;
        background-color: #fff;
        padding: 5px;
      }

      /* ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½ã®è¡Œã‚’è‰²åˆ†ã‘ */
      .premium-row th,
      .premium-row td {
        background-color: #fff8e1;
      }
      .time-header-row.premium-row th {
        background-color: #fff1c6; /* ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ã¯å°‘ã—æ¿ƒã„é»„è‰² */
        color: #b76a00;
      }

      /* ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½ï¼šè‡ªå‹•ãƒã‚¤ãƒ©ã‚¤ãƒˆã®è¡¨ç¾ */
      .highlight-blue {
        background-color: #e8f0fe !important;
      } /* 1.5å€ï¼ˆé’ï¼‰ */
      .highlight-yellow {
        background-color: #fff7e0 !important;
      } /* 2.0å€ï¼ˆé»„ï¼‰ */
      .highlight-red {
        background-color: #fce8e6 !important;
      } /* 3.0å€ï¼ˆèµ¤ï¼‰ */

      /* ãƒ¬ãƒãƒ¼ãƒˆã‚„è¨­å®šã‚·ãƒ¼ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« (æ–°ä»•æ§˜å¯¾å¿œ) */
      .report-grid,
      .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }
      .report-card,
      .settings-card {
        background: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
      }
      .report-card h3,
      .settings-card h3 {
        margin-top: 0;
        border-bottom: 2px solid #1a73e8;
        padding-bottom: 8px;
        color: #1a73e8;
      }

      /* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« (æ–°ä»•æ§˜) */
      .btn-primary, .btn-secondary, .btn-danger {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 10px;
        margin-bottom: 5px;
      }

      .btn-primary {
        background: #1976d2;
        color: white;
      }

      .btn-primary:hover {
        background: #1565c0;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }

      .btn-danger:hover {
        background: #c82333;
      }

      /* ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
      .data-complete {
        background-color: #d4edda;
        border-left: 4px solid #28a745;
        color: #155724;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }

      .data-incomplete {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
        color: #856404;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }

      .data-insufficient {
        background-color: #f8d7da;
        border-left: 4px solid #dc3545;
        color: #721c24;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }

      /* ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è¡¨ç¤º */
      .system-ready {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }

      .system-not-ready {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }

      /* æ³¨æ„æ›¸ãã‚¹ã‚¿ã‚¤ãƒ« */
      .note {
        font-size: 12px;
        color: #6c757d;
        margin-top: 10px;
        padding: 8px;
        background-color: #f8f9fa;
        border-radius: 4px;
        border-left: 3px solid #17a2b8;
      }
      .report-card li {
        font-size: 14px;
        padding: 5px 0;
      }
      .settings-card p {
        font-size: 14px;
      }
      .settings-card input[type='text'] {
        width: 95%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-family: monospace;
      }
      .settings-card .api-key-note {
        font-size: 12px;
        color: #5f6368;
      }
      .dashboard-kpi {
        font-size: 24px;
        font-weight: bold;
        color: #1a73e8;
      }

      /* æŠ•ç¨¿æ–‡çœç•¥è¡¨ç¤ºã¨ãƒ¢ãƒ¼ãƒ€ãƒ« */
      .truncated-text {
        cursor: pointer;
        color: #1976d2;
        text-decoration: none;
      }

      .truncated-text:hover {
        text-decoration: underline;
      }

      .post-text-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1000;
      }

      .modal-overlay {
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: white;
        border-radius: 8px;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        margin: 20px;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #eee;
      }

      .modal-body {
        padding: 20px;
        line-height: 1.6;
      }

      .close-btn {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #666;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .close-btn:hover {
        color: #333;
        background-color: #f5f5f5;
        border-radius: 50%;
      }

      /* ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°KPIè¡¨ç¤º */
      .follower-kpi-section {
        margin-bottom: 20px;
        padding: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        color: white;
      }

      .kpi-card {
        text-align: center;
      }

      .kpi-card h3 {
        margin: 0 0 10px 0;
        font-size: 16px;
        font-weight: 500;
      }

      .kpi-value {
        font-size: 36px;
        font-weight: bold;
        margin: 10px 0;
      }

      .kpi-timestamp {
        font-size: 12px;
        opacity: 0.8;
      }

      /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }
        .container {
          border-radius: 4px;
        }
        .modal-content {
          max-width: 90vw;
          margin: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- ã‚·ãƒ¼ãƒˆã‚¿ãƒ– (å¤‰æ›´ãªã—) -->
      <div class="sheet-tabs">
        <div class="tab active" onclick="showSheet(event, 'data')">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ (ãƒ¡ã‚¤ãƒ³)</div>
        <div class="tab" onclick="showSheet(event, 'dashboard')">ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
        <div class="tab" onclick="showSheet(event, 'report')">ğŸ“ˆ æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ (ãƒ—ãƒ¬ãƒŸã‚¢ãƒ )</div>
        <div class="tab" onclick="showSheet(event, 'settings')">âš™ï¸ è¨­å®š</div>
      </div>

      <!-- 1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (å¤‰æ›´ãªã—) -->
      <div id="dashboard" class="sheet-content">
        <!-- (å†…å®¹ã¯å¤‰æ›´ãªã—) -->
        <div class="settings-card">
          <h3>ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
          <p>ç¾åœ¨ã®ç·ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°</p>
          <div class="dashboard-kpi">10,234 äºº</div>
          <hr />
          <p>
            ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€Œãƒ‡ãƒ¼ã‚¿ã€ã‚·ãƒ¼ãƒˆã«Threadsã®æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•ã§è¨˜éŒ²ã—ã¾ã™ã€‚<br />
            ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€ã€Œæœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆã€ã‚„ã€Œè‡ªå‹•ãƒã‚¤ãƒ©ã‚¤ãƒˆã€æ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚
          </p>
        </div>
      </div>

      <!-- 2. ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰ã‚·ãƒ¼ãƒˆ (å¤‰æ›´ã‚ã‚Š) -->
      <div id="data" class="sheet-content active">
        <!-- ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°KPIè¡¨ç¤º -->
        <div class="follower-kpi-section">
          <div class="kpi-card">
            <h3>ç¾åœ¨ã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°</h3>
            <div class="kpi-value" id="current-followers">-</div>
            <div class="kpi-timestamp" id="follower-timestamp">-</div>
          </div>
        </div>

        <!-- æŠ•ç¨¿æ—¥æ™‚ã¨ãƒ‡ãƒ¼ã‚¿æ“ä½œã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div
          class="data-controls-section"
          style="
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
          "
        >
          <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap">
            <div style="flex: 1; min-width: 200px">
              <label
                for="post-datetime-input"
                style="display: block; margin-bottom: 5px; font-weight: 500; color: #495057"
                >ğŸ“… æŠ•ç¨¿æ—¥æ™‚</label
              >
              <input
                type="datetime-local"
                id="post-datetime-input"
                style="
                  width: 100%;
                  padding: 8px 12px;
                  border: 1px solid #ced4da;
                  border-radius: 4px;
                  font-size: 14px;
                "
              />
            </div>
            <div style="flex: 0 0 auto">
              <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #495057"
                >ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ“ä½œ</label
              >
              <div style="display: flex; gap: 10px">
                <button
                  id="fetch-and-save-btn"
                  onclick="fetchAndSaveData()"
                  style="
                    background: #28a745;
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                  "
                >
                  ğŸ“¥ å–å¾—ãƒ»ä¿å­˜
                </button>
                <button
                  id="load-timeseries-btn"
                  onclick="loadTimeSeriesData()"
                  style="
                    background: #007bff;
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                  "
                >
                  ğŸ“ˆ æ™‚ç³»åˆ—è¡¨ç¤º
                </button>
                <button
                  id="show-stats-btn"
                  onclick="showSpreadsheetStats()"
                  style="
                    background: #6c757d;
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                  "
                >
                  ğŸ“Š çµ±è¨ˆæƒ…å ±
                </button>
              </div>
            </div>
          </div>
          <div
            id="data-operation-status"
            style="margin-top: 10px; padding: 8px; border-radius: 4px; display: none"
          >
            <span id="data-operation-message">å¾…æ©Ÿä¸­...</span>
          </div>
        </div>

        <p style="font-size: 12px; color: #555">
          â€» æŠ•ç¨¿12æ™‚é–“å¾Œã«ã€Œç„¡æ–™ç‰ˆãƒ‡ãƒ¼ã‚¿ã€ãŒè‡ªå‹•è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚<br />
          â€»
          ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆã§ã¯ã€ã€Œæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã€ãŒè‡ªå‹•æ›´æ–°ã•ã‚Œã€å¹³å‡å€¤ã‚’è¶…ãˆãŸã‚»ãƒ«ãŒè‡ªå‹•ã§è‰²ä»˜ã‘ã•ã‚Œã¾ã™ã€‚
        </p>
        <div style="width: 100%; overflow-x: auto">
          <table class="spreadsheet" id="main-data-table">
            <thead>
              <tr id="table-header-row">
                <th>é …ç›® / æŠ•ç¨¿æ—¥æ™‚</th>
                <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã§å‹•çš„ã«ç”Ÿæˆ -->
              </tr>
            </thead>
            <tbody id="table-body">
              <!-- å…±é€šãƒ‡ãƒ¼ã‚¿ -->
              <tr class="post-text-row">
                <th>æŠ•ç¨¿æ–‡</th>
                <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã§å‹•çš„ã«ç”Ÿæˆ -->
              </tr>
              <tr>
                <th>æ–‡å­—æ•°</th>
                <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã§å‹•çš„ã«ç”Ÿæˆ -->
              </tr>
              <tr>
                <th>ã‚¿ã‚¤ãƒ—</th>
                <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã§å‹•çš„ã«ç”Ÿæˆ -->
              </tr>

              <!-- NEW: 12æ™‚é–“å¾Œ (ç„¡æ–™ç‰ˆ) ãƒ˜ãƒƒãƒ€ãƒ¼ -->
              <tr class="time-header-row">
                <th id="free-data-header" colspan="1">ã€12æ™‚é–“å¾Œã€‘(ç„¡æ–™ç‰ˆ)</th>
              </tr>
              <tr>
                <th>ã‚¤ãƒ³ãƒ—(12h)</th>
                <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã§å‹•çš„ã«ç”Ÿæˆ -->
              </tr>
              <tr>
                <th>ã„ã„ã­(12h)</th>
                <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã§å‹•çš„ã«ç”Ÿæˆ -->
              </tr>
              <tr>
                <th>å†æŠ•ç¨¿/å¼•ç”¨(12h)</th>
                <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã§å‹•çš„ã«ç”Ÿæˆ -->
              </tr>
              <tr>
                <th>ãƒªãƒ—ãƒ©ã‚¤(12h)</th>
                <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã§å‹•çš„ã«ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr>
                <th>Engç·æ•°(12h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr>
                <th>Engç‡(12h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr>
                <th>ç·ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼(12h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>

              <!-- NEW: 24æ™‚é–“å¾Œ (ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ) ãƒ˜ãƒƒãƒ€ãƒ¼ -->
              <tr class="spacer-row">
                <td colspan="1"></td>
              </tr>
              <tr class="time-header-row premium-row">
                <th colspan="1">ã€24æ™‚é–“å¾Œã€‘(ãƒ—ãƒ¬ãƒŸã‚¢ãƒ )</th>
              </tr>
              <tr class="premium-row">
                <th>ã‚¤ãƒ³ãƒ—(24h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>ã„ã„ã­(24h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>å†æŠ•ç¨¿/å¼•ç”¨(24h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>ãƒªãƒ—ãƒ©ã‚¤(24h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>Engç·æ•°(24h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>Engç‡(24h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>

              <!-- NEW: 72æ™‚é–“å¾Œ (ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ) ãƒ˜ãƒƒãƒ€ãƒ¼ -->
              <tr class="spacer-row">
                <td colspan="1"></td>
              </tr>
              <tr class="time-header-row premium-row">
                <th colspan="1">ã€72æ™‚é–“å¾Œã€‘(ãƒ—ãƒ¬ãƒŸã‚¢ãƒ )</th>
              </tr>
              <tr class="premium-row">
                <th>ã‚¤ãƒ³ãƒ—(72h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>ã„ã„ã­(72h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>å†æŠ•ç¨¿/å¼•ç”¨(72h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>ãƒªãƒ—ãƒ©ã‚¤(72h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>Engç·æ•°(72h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>Engç‡(72h)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>

              <!-- NEW: 7æ—¥å¾Œ (ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ) ãƒ˜ãƒƒãƒ€ãƒ¼ -->
              <tr class="spacer-row">
                <td colspan="1"></td>
              </tr>
              <tr class="time-header-row premium-row">
                <th colspan="1">ã€7æ—¥å¾Œã€‘(ãƒ—ãƒ¬ãƒŸã‚¢ãƒ )</th>
              </tr>
              <tr class="premium-row">
                <th>ã‚¤ãƒ³ãƒ—(7d)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>ã„ã„ã­(7d)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>å†æŠ•ç¨¿/å¼•ç”¨(7d)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>ãƒªãƒ—ãƒ©ã‚¤(7d)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>Engç·æ•°(7d)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>
              <tr class="premium-row">
                <th>Engç‡(7d)</th>
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
                                <!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã¯å‹•çš„ç”Ÿæˆ -->
              </tr>

              <!-- NEW: å…±é€šãƒ‡ãƒ¼ã‚¿ (æœ€å¾Œ) -->
              <tr class="spacer-row">
                <td colspan="1"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- 3. æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ï¼‰ (å¤‰æ›´ãªã—) -->
      <div id="report" class="sheet-content">
        <!-- (å†…å®¹ã¯å¤‰æ›´ãªã—) -->
        <div class="report-grid">
          <div class="report-card">
            <h3>ğŸ“ˆ 2025å¹´11æœˆ ã‚µãƒãƒªãƒ¼</h3>
            <ul>
              <li>1ãƒ¶æœˆã®ç·æŠ•ç¨¿æ•°: 50 ä»¶</li>
              <li>1ãƒ¶æœˆã®ç·ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ•°: 150,000</li>
              <li>å¹³å‡Engç‡ (12h): 7.2%</li>
            </ul>
          </div>
          <div class="report-card">
            <h3>ğŸ† åå¿œãŒè‰¯ã‹ã£ãŸæŠ•ç¨¿ ãƒ™ã‚¹ãƒˆ10 (ã‚¤ãƒ³ãƒ—é †)</h3>
            <ol>
              <li><a href="#">ã€é€Ÿå ±ã€‘Threadsåˆ†æãƒ„ãƒ¼ãƒ«ã€ã¤ã„ã«å®Œæˆï¼ (3,500)</a></li>
              <li><a href="#">ï¼ˆæŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«...ï¼‰ (2,800)</a></li>
              <li><a href="#">ï¼ˆæŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«...ï¼‰ (2,200)</a></li>
              <!-- ... -->
            </ol>
          </div>
          <div class="report-card">
            <h3>ğŸ”‘ åå¿œãŒè‰¯ã‹ã£ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é›†</h3>
            <p>ï¼ˆã“ã‚Œã‚‰ã®å˜èªãŒå«ã¾ã‚Œã‚‹æŠ•ç¨¿ã¯ã€å¹³å‡ã‚ˆã‚ŠEngç‡ãŒé«˜ã„å‚¾å‘ã«ã‚ã‚Šã¾ã™ï¼‰</p>
            <ol>
              <li>åˆ†æ (+3.5%)</li>
              <li>é€Ÿå ± (+2.1%)</li>
              <li>GAS (+1.8%)</li>
              <!-- ... -->
            </ol>
          </div>
        </div>
      </div>

      <!-- 4. è¨­å®šã‚·ãƒ¼ãƒˆ (æ–°ä»•æ§˜å¯¾å¿œ) -->
      <div id="settings" class="sheet-content">
        <h2>âš™ï¸ è¨­å®š</h2>

        <!-- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è¡¨ç¤º -->
        <div class="settings-card">
          <h3>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</h3>
          <div id="system-status-indicator">
            <span id="system-status-text">èª­ã¿è¾¼ã¿ä¸­...</span>
          </div>
          <div style="margin-top: 10px">
            <button onclick="checkSystemStatus()" class="btn-secondary">çŠ¶æ…‹ã‚’æ›´æ–°</button>
          </div>
        </div>

        <div class="settings-grid">
          <div class="settings-card">
            <h3>ğŸ“Š ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè¨­å®š</h3>
            <div id="spreadsheet-config-section">
              <p>ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’è¨­å®šã—ã¦ãã ã•ã„</p>
              <div id="spreadsheet-id-status" style="margin-bottom: 10px">
                <span id="spreadsheet-id-indicator" style="color: #666">èª­ã¿è¾¼ã¿ä¸­...</span>
              </div>
              <div id="spreadsheet-id-form">
                <input
                  type="text"
                  id="spreadsheet-id-input"
                  placeholder="ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                  style="width: 95%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; margin-bottom: 10px"
                />
                <button onclick="saveSpreadsheetId()" class="btn-primary">ä¿å­˜</button>
              </div>
              <div id="spreadsheet-actions" style="margin-top: 10px">
                <button onclick="testSpreadsheetAccess()" class="btn-secondary">æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
                <button onclick="initializeDatabase()" class="btn-secondary">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–</button>
              </div>
              <p class="note">
                â€»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã¯ç·¨é›†æ¨©é™ãŒå¿…è¦ã§ã™<br>
                â€»åˆå›è¨­å®šæ™‚ã¯ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã€ã§ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’è‡ªå‹•ä½œæˆã—ã¾ã™
              </p>
            </div>
          </div>

          <div class="settings-card">
            <h3>ğŸ”‘ APIè¨­å®š</h3>
            <div id="api-key-section">
              <p>Threads API ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³</p>
              <div id="api-key-status" style="margin-bottom: 10px">
                <span id="api-key-indicator" style="color: #666">èª­ã¿è¾¼ã¿ä¸­...</span>
              </div>
              <div id="api-key-form" style="display: none">
                <input
                  type="password"
                  id="api-key-input"
                  placeholder="APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                  style="width: 300px; margin-right: 10px"
                />
                <button
                  onclick="saveApiKey()"
                  style="
                    background: #1976d2;
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 4px;
                    cursor: pointer;
                  "
                >
                  ä¿å­˜
                </button>
              </div>
              <div id="api-key-actions" style="margin-top: 10px">
                <button
                  id="edit-api-key-btn"
                  onclick="showApiKeyForm()"
                  style="
                    background: #f57c00;
                    color: white;
                    border: none;
                    padding: 6px 12px;
                    border-radius: 4px;
                    cursor: pointer;
                    margin-right: 10px;
                  "
                >
                  ç·¨é›†
                </button>
                <button
                  id="delete-api-key-btn"
                  onclick="deleteApiKey()"
                  style="
                    background: #d32f2f;
                    color: white;
                    border: none;
                    padding: 6px 12px;
                    border-radius: 4px;
                    cursor: pointer;
                  "
                >
                  å‰Šé™¤
                </button>
              </div>
              <p class="api-key-note" style="font-size: 12px; color: #666; margin-top: 10px">
                â€»APIã‚­ãƒ¼ã¯å®‰å…¨ã«æš—å·åŒ–ã•ã‚Œã¦ä¿å­˜ã•ã‚Œã¾ã™<br />
                â€»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«å¾“ã„ã”è‡ªèº«ã§å–å¾—ã—ãŸAPIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
              </p>
            </div>
          </div>

          <div class="settings-card">
            <h3>ğŸ§ª æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿å–å¾—</h3>
            <div id="api-test-section">
              <p>Threads APIã‹ã‚‰å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ‰‹å‹•ã§å–å¾—ã—ã¦ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜ã—ã¾ã™</p>
              <div id="test-controls" style="margin: 15px 0">
                <button
                  id="manual-fetch-btn"
                  onclick="manualFetchAndSave()"
                  style="
                    background: #1976d2;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 4px;
                    cursor: pointer;
                    margin-right: 10px;
                    font-weight: bold;
                  "
                >
                  ğŸš€ ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜ã‚’å®Ÿè¡Œ
                </button>
                <button
                  id="test-api-btn"
                  onclick="testThreadsApi()"
                  style="
                    background: #4caf50;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 4px;
                    cursor: pointer;
                    margin-right: 10px;
                  "
                >
                  ğŸ“Š APIæ¥ç¶šãƒ†ã‚¹ãƒˆï¼ˆè¡¨ç¤ºã®ã¿ï¼‰
                </button>
                <button
                  id="refresh-data-btn"
                  onclick="refreshTableData()"
                  style="
                    background: #388e3c;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 4px;
                    cursor: pointer;
                  "
                >
                  ğŸ”„ ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
                </button>
              </div>
              <div
                id="test-status"
                style="margin: 10px 0; padding: 10px; border-radius: 4px; display: none"
              >
                <span id="test-message">å¾…æ©Ÿä¸­...</span>
              </div>
              <div id="test-results" style="margin-top: 15px; display: none">
                <h4>å–å¾—ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:</h4>
                <pre
                  id="test-data"
                  style="
                    background: #f5f5f5;
                    padding: 10px;
                    border-radius: 4px;
                    font-size: 12px;
                    max-height: 200px;
                    overflow-y: auto;
                  "
                ></pre>
              </div>
              <div id="debug-log" style="margin-top: 15px">
                <h4>ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°:</h4>
                <div
                  id="log-container"
                  style="
                    background: #f9f9f9;
                    border: 1px solid #ddd;
                    padding: 10px;
                    border-radius: 4px;
                    max-height: 300px;
                    overflow-y: auto;
                    font-family: monospace;
                    font-size: 11px;
                  "
                >
                  <div class="log-entry">ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†</div>
                </div>
                <button
                  onclick="clearDebugLog()"
                  style="
                    margin-top: 5px;
                    background: #666;
                    color: white;
                    border: none;
                    padding: 4px 8px;
                    border-radius: 2px;
                    font-size: 11px;
                  "
                >
                  ãƒ­ã‚°ã‚¯ãƒªã‚¢
                </button>
              </div>
            </div>

            <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDè¨­å®šã¯ä¸Šéƒ¨ã«çµ±åˆæ¸ˆã¿ -->
          <div class="settings-card">
            <h3>â° è‡ªå‹•å®Ÿè¡Œè¨­å®š</h3>
            <div id="batch-config-section">
              <p>1æ™‚é–“æ¯ã®è‡ªå‹•ãƒ‡ãƒ¼ã‚¿åé›†ã‚’è¨­å®šã§ãã¾ã™ã€‚</p>
              <div id="batch-status" style="margin-bottom: 10px">
                <span id="batch-status-indicator" style="color: #666">èª­ã¿è¾¼ã¿ä¸­...</span>
              </div>
              <div style="margin-top: 10px">
                <button onclick="setupBatchTrigger()" class="btn-primary">è‡ªå‹•å®Ÿè¡Œã‚’é–‹å§‹</button>
                <button onclick="stopBatchTrigger()" class="btn-danger">è‡ªå‹•å®Ÿè¡Œã‚’åœæ­¢</button>
              </div>
              <div style="margin-top: 10px">
                <button onclick="refreshBatchStatus()" class="btn-secondary">å®Ÿè¡ŒçŠ¶æ³ã‚’æ›´æ–°</button>
              </div>
              
              <!-- ãƒãƒƒãƒå®Ÿè¡Œçµ±è¨ˆ -->
              <div id="batch-statistics" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; display: none;">
                <h4 style="margin-top: 0;">ğŸ“Š å®Ÿè¡Œçµ±è¨ˆ (éå»30æ—¥)</h4>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 14px;">
                  <div><strong>ç·å®Ÿè¡Œå›æ•°:</strong> <span id="stat-total-executions">-</span></div>
                  <div><strong>æˆåŠŸå›æ•°:</strong> <span id="stat-successful-executions" style="color: #28a745;">-</span></div>
                  <div><strong>å¤±æ•—å›æ•°:</strong> <span id="stat-failed-executions" style="color: #dc3545;">-</span></div>
                  <div><strong>ã‚¨ãƒ©ãƒ¼ç‡:</strong> <span id="stat-error-rate">-</span>%</div>
                  <div><strong>å¹³å‡å‡¦ç†ä»¶æ•°:</strong> <span id="stat-avg-posts">-</span>ä»¶</div>
                  <div><strong>å¹³å‡å®Ÿè¡Œæ™‚é–“:</strong> <span id="stat-avg-time">-</span>ms</div>
                  <div><strong>æœ€çµ‚å®Ÿè¡Œ:</strong> <span id="stat-last-execution">-</span></div>
                  <div><strong>ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹:</strong> <span id="stat-health-status">-</span></div>
                </div>
              </div>
              
              <!-- æœ€è¿‘ã®ãƒ­ã‚° -->
              <div id="batch-recent-logs" style="margin-top: 20px; display: none;">
                <h4>ğŸ“‹ æœ€è¿‘ã®å®Ÿè¡Œãƒ­ã‚° (æœ€æ–°10ä»¶)</h4>
                <div id="batch-logs-container" style="max-height: 300px; overflow-y: auto; background: #fff; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px;">
                  <!-- ãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
              </div>
              
              <p class="note">
                â€»è‡ªå‹•å®Ÿè¡Œã«ã¯ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã¨APIã‚­ãƒ¼ã®è¨­å®šãŒå¿…è¦ã§ã™
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆç”¨ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆ
      function showSheet(e, sheetId) {
        // ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤ºã«
        var contents = document.getElementsByClassName('sheet-content');
        for (var i = 0; i < contents.length; i++) {
          contents[i].classList.remove('active');
        }
        // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
        var tabs = document.getElementsByClassName('tab');
        for (var i = 0; i < tabs.length; i++) {
          tabs[i].classList.remove('active');
        }
        // é¸æŠã•ã‚ŒãŸã‚‚ã®ã‚’è¡¨ç¤º
        document.getElementById(sheetId).classList.add('active');
        e.currentTarget.classList.add('active');
      }

      // APIã‚­ãƒ¼ç®¡ç†æ©Ÿèƒ½
      function checkApiKeyStatus() {
        google.script.run
          .withSuccessHandler(function (hasKey) {
            var indicator = document.getElementById('api-key-indicator');
            var editBtn = document.getElementById('edit-api-key-btn');
            var deleteBtn = document.getElementById('delete-api-key-btn');

            if (hasKey) {
              indicator.textContent = 'âœ… APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™';
              indicator.style.color = '#2e7d32';
              editBtn.style.display = 'inline-block';
              deleteBtn.style.display = 'inline-block';
            } else {
              indicator.textContent = 'âŒ APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“';
              indicator.style.color = '#d32f2f';
              editBtn.style.display = 'inline-block';
              deleteBtn.style.display = 'none';
              showApiKeyForm(); // æœªè¨­å®šã®å ´åˆã¯å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
            }
          })
          .withFailureHandler(function (error) {
            console.error('APIã‚­ãƒ¼çŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
            document.getElementById('api-key-indicator').textContent = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
          })
          .hasApiKey();
      }

      function showApiKeyForm() {
        document.getElementById('api-key-form').style.display = 'block';
        document.getElementById('api-key-input').focus();
      }

      function hideApiKeyForm() {
        document.getElementById('api-key-form').style.display = 'none';
        document.getElementById('api-key-input').value = '';
      }

      function saveApiKey() {
        var apiKey = document.getElementById('api-key-input').value.trim();
        addDebugLog('ğŸ”‘ APIã‚­ãƒ¼ä¿å­˜é–‹å§‹', 'info');

        if (!apiKey) {
          alert('APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          addDebugLog('âŒ APIã‚­ãƒ¼ãŒç©ºã§ã™', 'error');
          return;
        }

        addDebugLog('APIã‚­ãƒ¼é•·: ' + apiKey.length + 'æ–‡å­—', 'info');

        google.script.run
          .withSuccessHandler(function (result) {
            addDebugLog(
              'APIã‚­ãƒ¼ä¿å­˜çµæœ: ' + JSON.stringify(result),
              result.success ? 'success' : 'error'
            );

            if (result.success) {
              alert(result.message);
              hideApiKeyForm();
              checkApiKeyStatus();
              addDebugLog('âœ… APIã‚­ãƒ¼ä¿å­˜æˆåŠŸ', 'success');
            } else {
              alert('ã‚¨ãƒ©ãƒ¼: ' + result.message);
              addDebugLog('âŒ APIã‚­ãƒ¼ä¿å­˜å¤±æ•—: ' + result.message, 'error');
            }
          })
          .withFailureHandler(function (error) {
            console.error('APIã‚­ãƒ¼ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            addDebugLog('âŒ APIã‚­ãƒ¼ä¿å­˜ä¾‹å¤–: ' + error.message, 'error');
            alert('APIã‚­ãƒ¼ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
          })
          .saveApiKey(apiKey);
      }

      function deleteApiKey() {
        if (!confirm('APIã‚­ãƒ¼ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
          return;
        }

        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              alert(result.message);
              checkApiKeyStatus();
            } else {
              alert('ã‚¨ãƒ©ãƒ¼: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('APIã‚­ãƒ¼å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
            alert('APIã‚­ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
          })
          .deleteApiKey();
      }

      // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æ©Ÿèƒ½
      function addDebugLog(message, type) {
        type = type || 'info';
        var timestamp = new Date().toLocaleTimeString();
        var logContainer = document.getElementById('log-container');
        var logEntry = document.createElement('div');
        logEntry.className = 'log-entry';

        var color = '#333';
        if (type === 'error') color = '#d32f2f';
        if (type === 'success') color = '#2e7d32';
        if (type === 'warning') color = '#f57c00';

        logEntry.innerHTML =
          '<span style="color: #666;">[' +
          timestamp +
          ']</span> <span style="color: ' +
          color +
          ';">' +
          message +
          '</span>';
        logContainer.appendChild(logEntry);
        logContainer.scrollTop = logContainer.scrollHeight;
      }

      function clearDebugLog() {
        var logContainer = document.getElementById('log-container');
        logContainer.innerHTML = '<div class="log-entry">ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Œäº†</div>';
      }

      // æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜æ©Ÿèƒ½
      function manualFetchAndSave() {
        addDebugLog('ğŸš€ æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜é–‹å§‹', 'info');
        showTestStatus('loading', 'ğŸ”„ å®Ÿè¡Œä¸­...');

        // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
        document.getElementById('manual-fetch-btn').disabled = true;
        document.getElementById('manual-fetch-btn').textContent = 'â³ å®Ÿè¡Œä¸­...';

        google.script.run
          .withSuccessHandler(function (result) {
            document.getElementById('manual-fetch-btn').disabled = false;
            document.getElementById('manual-fetch-btn').textContent = 'ğŸš€ ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜ã‚’å®Ÿè¡Œ';

            if (result.success) {
              showTestStatus('success', 'âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜æˆåŠŸï¼ ' + (result.count || 0) + 'ä»¶ä¿å­˜ã—ã¾ã—ãŸ');
              addDebugLog('âœ… æ‰‹å‹•å®Ÿè¡ŒæˆåŠŸ: ' + (result.count || 0) + 'ä»¶', 'success');
              
              // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
              refreshTableData();
            } else {
              showTestStatus('error', 'âŒ å¤±æ•—: ' + result.message);
              addDebugLog('âŒ æ‰‹å‹•å®Ÿè¡Œå¤±æ•—: ' + result.message, 'error');
            }
          })
          .withFailureHandler(function (error) {
            document.getElementById('manual-fetch-btn').disabled = false;
            document.getElementById('manual-fetch-btn').textContent = 'ğŸš€ ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜ã‚’å®Ÿè¡Œ';
            
            showTestStatus('error', 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            addDebugLog('âŒ æ‰‹å‹•å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
          })
          .hourlyBatchDataCollection();
      }

      // APIãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ï¼ˆæ¥ç¶šç¢ºèªã®ã¿ã€ä¿å­˜ã—ãªã„ï¼‰
      function testThreadsApi() {
        addDebugLog('ğŸ”„ APIæ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
        showTestStatus('loading', 'ğŸ”„ APIã‚­ãƒ¼ã‚’ç¢ºèªä¸­...');

        google.script.run
          .withSuccessHandler(function (hasKey) {
            addDebugLog(
              'APIã‚­ãƒ¼ç¢ºèªçµæœ: ' + (hasKey ? 'è¨­å®šæ¸ˆã¿' : 'æœªè¨­å®š'),
              hasKey ? 'success' : 'warning'
            );

            if (!hasKey) {
              showTestStatus(
                'error',
                'âŒ APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãšAPIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚'
              );
              addDebugLog('âŒ APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
              return;
            }

            showTestStatus('loading', 'ğŸ“¡ Threads APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...');
            addDebugLog('ğŸ“¡ Threads APIå‘¼ã³å‡ºã—é–‹å§‹', 'info');

            google.script.run
              .withSuccessHandler(function (result) {
                addDebugLog(
                  'APIå‘¼ã³å‡ºã—å®Œäº†: ' + JSON.stringify(result, null, 2),
                  result.success ? 'success' : 'error'
                );

                if (result.success) {
                  showTestStatus('success', 'âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸï¼');
                  showTestResults(result.data);
                  addDebugLog(
                    'âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ - ãƒ¦ãƒ¼ã‚¶ãƒ¼: ' +
                      (result.data.user ? result.data.user.username : 'N/A'),
                    'success'
                  );
                } else {
                  showTestStatus('error', 'âŒ ã‚¨ãƒ©ãƒ¼: ' + result.message);
                  addDebugLog('âŒ API ã‚¨ãƒ©ãƒ¼: ' + result.message, 'error');
                }
              })
              .withFailureHandler(function (error) {
                console.error('API ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                addDebugLog('âŒ APIå‘¼ã³å‡ºã—å¤±æ•—: ' + error.message, 'error');
                showTestStatus('error', 'âŒ APIå‘¼ã³å‡ºã—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
              })
              .testThreadsApiConnection();
          })
          .withFailureHandler(function (error) {
            console.error('APIã‚­ãƒ¼ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
            addDebugLog('âŒ APIã‚­ãƒ¼ç¢ºèªå¤±æ•—: ' + error.message, 'error');
            showTestStatus('error', 'âŒ APIã‚­ãƒ¼ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
          })
          .hasApiKey();
      }

      function refreshTableData() {
        showTestStatus('loading', 'ğŸ”„ ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ä¸­...');

        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              showTestStatus('success', 'âœ… ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°å®Œäº†ï¼');
              updateDataTable(result.data);
            } else {
              showTestStatus('error', 'âŒ ã‚¨ãƒ©ãƒ¼: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
            showTestStatus('error', 'âŒ ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
          })
          .fetchAndUpdateTableData();
      }

      function showTestStatus(type, message) {
        var statusDiv = document.getElementById('test-status');
        var messageSpan = document.getElementById('test-message');

        statusDiv.style.display = 'block';
        messageSpan.textContent = message;

        // ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š
        statusDiv.className = '';
        if (type === 'loading') {
          statusDiv.style.background = '#e3f2fd';
          statusDiv.style.color = '#1976d2';
          statusDiv.style.border = '1px solid #bbdefb';
        } else if (type === 'success') {
          statusDiv.style.background = '#e8f5e8';
          statusDiv.style.color = '#2e7d32';
          statusDiv.style.border = '1px solid #c8e6c9';
        } else if (type === 'error') {
          statusDiv.style.background = '#ffebee';
          statusDiv.style.color = '#c62828';
          statusDiv.style.border = '1px solid #ffcdd2';
        }
      }

      function showTestResults(data) {
        var resultsDiv = document.getElementById('test-results');
        var dataPreElement = document.getElementById('test-data');

        resultsDiv.style.display = 'block';
        dataPreElement.textContent = JSON.stringify(data, null, 2);
      }

      function updateDataTable(data) {
        // ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯
        // å®Ÿéš›ã®ãƒ†ãƒ¼ãƒ–ãƒ«è¦ç´ ã‚’æ›´æ–°
        if (data && data.posts && data.posts.length > 0) {
          // æœ€æ–°3ä»¶ã®æŠ•ç¨¿ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
          var posts = data.posts.slice(0, 3);

          // æŠ•ç¨¿æ–‡ã®æ›´æ–°
          var postTextCells = document.querySelectorAll('.post-text-row td.data-cell');
          posts.forEach(function (post, index) {
            if (postTextCells[index] && post.text) {
              var fullText = post.text;
              var truncatedText = fullText.length > 25 ? fullText.substring(0, 25) + '...' : fullText;

              postTextCells[index].setAttribute('data-full-text', fullText);
              postTextCells[index].innerHTML = `
                <span class="truncated-text" onclick="showPostTextModal('${fullText.replace(/'/g, "\\'")}')">
                  ${truncatedText}
                </span>
              `;
            }
          });

          // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®æ›´æ–°
          updateMetricRow(
            'ã‚¤ãƒ³ãƒ—(12h)',
            posts.map(p => p.insights.views || 0)
          );
          updateMetricRow(
            'ã„ã„ã­(12h)',
            posts.map(p => p.insights.likes || 0)
          );
          updateMetricRow(
            'å†æŠ•ç¨¿/å¼•ç”¨(12h)',
            posts.map(p => (p.insights.reposts || 0) + (p.insights.quotes || 0))
          );
          updateMetricRow(
            'ãƒªãƒ—ãƒ©ã‚¤(12h)',
            posts.map(p => p.insights.replies || 0)
          );
          updateMetricRow(
            'Engç·æ•°(12h)',
            posts.map(p => p.insights.totalEngagement || 0)
          );
          updateMetricRow(
            'Engç‡(12h)',
            posts.map(p => p.insights.engagementRate + '%' || '0%')
          );
        }
      }

      function updateMetricRow(metricName, values) {
        var rows = document.querySelectorAll('tr');
        for (var i = 0; i < rows.length; i++) {
          var firstCell = rows[i].querySelector('th');
          if (firstCell && firstCell.textContent.trim() === metricName) {
            var dataCells = rows[i].querySelectorAll('td');
            values.forEach(function (value, index) {
              if (dataCells[index]) {
                dataCells[index].textContent = value;
              }
            });
            break;
          }
        }
      }

      // æŠ•ç¨¿æ–‡çœç•¥è¡¨ç¤ºæ©Ÿèƒ½
      function truncatePostText(text, maxLength = 25) {
        if (!text || text.length <= maxLength) return text;
        return text.substring(0, maxLength) + '...';
      }

      function updatePostTextCells() {
        const postTextCells = document.querySelectorAll('.post-text-row td');
        postTextCells.forEach(cell => {
          const fullText = cell.getAttribute('data-full-text') || cell.textContent;
          if (!fullText || fullText.trim() === '' || fullText === '-') return;

          cell.setAttribute('data-full-text', fullText);
          const truncatedText = truncatePostText(fullText);

          cell.innerHTML = `
            <span class="truncated-text" onclick="showPostTextModal('${fullText.replace(/'/g, "\\'")}')">
              ${truncatedText}
            </span>
          `;
        });
      }

      // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ©Ÿèƒ½
      function showPostTextModal(fullText) {
        try {
          if (!fullText) {
            console.warn('æŠ•ç¨¿æ–‡ãŒç©ºã§ã™');
            return;
          }
          
          // æ—¢å­˜ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å‰Šé™¤
          closePostTextModal();
          
          const modal = document.createElement('div');
          modal.className = 'post-text-modal';
          
          // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
          const escapedText = String(fullText)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');
          
          modal.innerHTML = `
            <div class="modal-overlay" onclick="closePostTextModal()">
              <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                  <h3>æŠ•ç¨¿æ–‡</h3>
                  <button class="close-btn" onclick="closePostTextModal()">&times;</button>
                </div>
                <div class="modal-body">
                  <p>${escapedText}</p>
                </div>
              </div>
            </div>
          `;
          
          if (document.body) {
            document.body.appendChild(modal);
          } else {
            console.error('document.body ãŒ null ã§ã™');
            return;
          }

          // ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹
          const escapeHandler = function (e) {
            if (e.key === 'Escape') {
              closePostTextModal();
              document.removeEventListener('keydown', escapeHandler);
            }
          };
          document.addEventListener('keydown', escapeHandler);
          
        } catch (error) {
          console.error('ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
        }
      }

      function closePostTextModal() {
        try {
          const modals = document.querySelectorAll('.post-text-modal');
          modals.forEach(function (modal) {
            if (modal && modal.parentNode) {
              modal.parentNode.removeChild(modal);
            }
          });
        } catch (error) {
          console.error('ãƒ¢ãƒ¼ãƒ€ãƒ«å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
        }
      }

      // ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢ãƒ»ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ç®¡ç†
      function clearSampleData() {
        const dataCells = document.querySelectorAll('.data-cell');
        dataCells.forEach(cell => {
          cell.textContent = '';
          cell.setAttribute('data-value', '');
          // æŠ•ç¨¿æ–‡ã‚»ãƒ«ã®å ´åˆã¯ã€data-full-textå±æ€§ã‚‚ã‚¯ãƒªã‚¢
          if (cell.getAttribute('data-metric') === 'post_text') {
            cell.removeAttribute('data-full-text');
            cell.innerHTML = '';
          }
        });
      }

      function showLoadingState() {
        const spreadsheet = document.querySelector('.spreadsheet');
        if (spreadsheet) {
          spreadsheet.classList.add('loading');
        }
      }

      function hideLoadingState() {
        const spreadsheet = document.querySelector('.spreadsheet');
        if (spreadsheet) {
          spreadsheet.classList.remove('loading');
        }
      }

      // ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°è¡¨ç¤ºæ›´æ–°
      function updateFollowerDisplay(count, timestamp) {
        const followersElement = document.getElementById('current-followers');
        const timestampElement = document.getElementById('follower-timestamp');

        if (followersElement) {
          followersElement.textContent = count ? count.toLocaleString() + ' äºº' : '-';
        }

        if (timestampElement && timestamp) {
          timestampElement.textContent = 'æœ€çµ‚æ›´æ–°: ' + new Date(timestamp).toLocaleString();
        }
      }

      // æ—¥ä»˜ã‚«ãƒ©ãƒ è¨­å®š
      function setupDateColumns() {
        const dateHeaders = document.querySelectorAll('th:not(.sticky-column)');
        dateHeaders.forEach(header => {
          // æœ€åˆã®ã‚«ãƒ©ãƒ ï¼ˆé …ç›®åï¼‰ä»¥å¤–ã‚’æ—¥ä»˜ã‚«ãƒ©ãƒ ã¨ã—ã¦è¨­å®š
          if (header.cellIndex > 0) {
            header.classList.add('date-column');
          }
        });
      }

      // ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ åˆæœŸåŒ–
      function setupStickyColumns() {
        const firstColumns = document.querySelectorAll('th:first-child, td:first-child');
        firstColumns.forEach(col => {
          col.classList.add('sticky-column');
        });
      }

      // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸæ©Ÿèƒ½
      function setupScrollSync() {
        const container =
          document.querySelector('.spreadsheet-container') ||
          document.querySelector('div[style*="overflow-x: auto"]');
        if (!container) return;

        const stickyColumns = document.querySelectorAll('.sticky-column');

        container.addEventListener('scroll', function () {
          const scrollLeft = container.scrollLeft;

          // ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ ã®å½±ã®èª¿æ•´
          stickyColumns.forEach(col => {
            if (scrollLeft > 0) {
              col.classList.add('scrolled');
            } else {
              col.classList.remove('scrolled');
            }
          });
        });
      }

      // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDç®¡ç†é–¢æ•°
      function checkSpreadsheetIdStatus() {
        google.script.run
          .withSuccessHandler(function (hasSpreadsheetId) {
            var indicator = document.getElementById('spreadsheet-id-indicator');
            var editBtn = document.getElementById('edit-spreadsheet-id-btn');
            var deleteBtn = document.getElementById('delete-spreadsheet-id-btn');
            var testBtn = document.getElementById('test-spreadsheet-btn');

            if (hasSpreadsheetId) {
              indicator.textContent = 'âœ… ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™';
              indicator.style.color = '#2e7d32';
              editBtn.style.display = 'inline-block';
              deleteBtn.style.display = 'inline-block';
              testBtn.style.display = 'inline-block';
            } else {
              indicator.textContent = 'âŒ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“';
              indicator.style.color = '#d32f2f';
              editBtn.style.display = 'inline-block';
              deleteBtn.style.display = 'none';
              testBtn.style.display = 'none';
              showSpreadsheetIdForm(); // æœªè¨­å®šã®å ´åˆã¯å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
            }
          })
          .withFailureHandler(function (error) {
            console.error('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDçŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
            document.getElementById('spreadsheet-id-indicator').textContent =
              'ã‚¨ãƒ©ãƒ¼: ' + error.message;
          })
          .hasSpreadsheetId();
      }

      function showSpreadsheetIdForm() {
        document.getElementById('spreadsheet-id-form').style.display = 'block';
        document.getElementById('spreadsheet-id-input').focus();
      }

      function hideSpreadsheetIdForm() {
        document.getElementById('spreadsheet-id-form').style.display = 'none';
        document.getElementById('spreadsheet-id-input').value = '';
      }

      function saveSpreadsheetId() {
        var spreadsheetId = document.getElementById('spreadsheet-id-input').value.trim();

        if (!spreadsheetId) {
          alert('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
          return;
        }

        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã®å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ï¼‰
        if (spreadsheetId.length < 20 || !/^[a-zA-Z0-9_-]+$/.test(spreadsheetId)) {
          alert('ç„¡åŠ¹ãªã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã§ã™ã€‚æ­£ã—ã„å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
          return;
        }

        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              alert('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚');
              hideSpreadsheetIdForm();
              checkSpreadsheetIdStatus();
            } else {
              alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            alert('ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
          })
          .saveSpreadsheetId(spreadsheetId);
      }

      function deleteSpreadsheetId() {
        if (!confirm('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          return;
        }

        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              alert('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
              checkSpreadsheetIdStatus();
            } else {
              alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDå‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
            alert('å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
          })
          .deleteSpreadsheetId();
      }

      function testSpreadsheetAccess() {
        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              alert(
                'âœ… ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®æ¥ç¶šã«æˆåŠŸã—ã¾ã—ãŸï¼\n\nã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå: ' +
                  result.data.name
              );
            } else {
              alert('âŒ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ:\n' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ¥ç¶šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            alert('æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
          })
          .testSpreadsheetAccess();
      }

      // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æºé–¢æ•°
      function showDataOperationStatus(type, message) {
        var statusDiv = document.getElementById('data-operation-status');
        var messageSpan = document.getElementById('data-operation-message');

        statusDiv.style.display = 'block';
        messageSpan.textContent = message;

        // ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š
        statusDiv.className = '';
        if (type === 'loading') {
          statusDiv.style.background = '#e3f2fd';
          statusDiv.style.color = '#1976d2';
          statusDiv.style.border = '1px solid #bbdefb';
        } else if (type === 'success') {
          statusDiv.style.background = '#e8f5e8';
          statusDiv.style.color = '#2e7d32';
          statusDiv.style.border = '1px solid #c8e6c9';
        } else if (type === 'error') {
          statusDiv.style.background = '#ffebee';
          statusDiv.style.color = '#c62828';
          statusDiv.style.border = '1px solid #ffcdd2';
        }
      }

      function fetchAndSaveData() {
        // APIã‚­ãƒ¼ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã®ç¢ºèª
        if (!document.getElementById('api-key-indicator').textContent.includes('âœ…')) {
          alert('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è¨­å®šã‚¿ãƒ–ã§APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚');
          return;
        }

        if (!document.getElementById('spreadsheet-id-indicator').textContent.includes('âœ…')) {
          alert(
            'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è¨­å®šã‚¿ãƒ–ã§ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚'
          );
          return;
        }

        showDataOperationStatus('loading', 'ğŸ“¡ Threads APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...');

        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              showDataOperationStatus(
                'success',
                `âœ… ${result.data.postsProcessed}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼`
              );

              // 5ç§’å¾Œã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’éè¡¨ç¤º
              setTimeout(function () {
                document.getElementById('data-operation-status').style.display = 'none';
              }, 5000);
            } else {
              showDataOperationStatus('error', 'âŒ ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜ã«å¤±æ•—: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            showDataOperationStatus('error', 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
          })
          .fetchAndSaveToSpreadsheet();
      }

      function loadTimeSeriesData() {
        var postDateInput = document.getElementById('post-datetime-input');
        var postDate = postDateInput.value;

        if (!postDate) {
          alert('æŠ•ç¨¿æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
          postDateInput.focus();
          return;
        }

        if (!document.getElementById('spreadsheet-id-indicator').textContent.includes('âœ…')) {
          alert(
            'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è¨­å®šã‚¿ãƒ–ã§ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚'
          );
          return;
        }

        showDataOperationStatus('loading', 'ğŸ“ˆ æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...');

        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              showDataOperationStatus(
                'success',
                `âœ… ${result.data.length}ä»¶ã®æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸ`
              );

              // ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
              displayTimeSeriesData(result.data);

              // 5ç§’å¾Œã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’éè¡¨ç¤º
              setTimeout(function () {
                document.getElementById('data-operation-status').style.display = 'none';
              }, 5000);
            } else {
              showDataOperationStatus('error', 'âŒ æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            showDataOperationStatus('error', 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
          })
          .getTimeSeriesData(postDate, 12);
      }

      function showSpreadsheetStats() {
        if (!document.getElementById('spreadsheet-id-indicator').textContent.includes('âœ…')) {
          alert(
            'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è¨­å®šã‚¿ãƒ–ã§ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚'
          );
          return;
        }

        showDataOperationStatus('loading', 'ğŸ“Š çµ±è¨ˆæƒ…å ±ã‚’å–å¾—ä¸­...');

        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              var stats = result.data;
              var message =
                `ğŸ“Š çµ±è¨ˆæƒ…å ±\n` +
                `ãƒ»ç·ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°: ${stats.totalRows}ä»¶\n` +
                `ãƒ»æœ€çµ‚æ›´æ–°: ${stats.lastUpdate ? new Date(stats.lastUpdate).toLocaleString() : 'æœªæ›´æ–°'}\n` +
                `ãƒ»ã‚·ãƒ¼ãƒˆå: ${stats.sheetName}`;

              alert(message);
              showDataOperationStatus('success', 'âœ… çµ±è¨ˆæƒ…å ±ã‚’å–å¾—ã—ã¾ã—ãŸ');

              // 3ç§’å¾Œã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’éè¡¨ç¤º
              setTimeout(function () {
                document.getElementById('data-operation-status').style.display = 'none';
              }, 3000);
            } else {
              showDataOperationStatus('error', 'âŒ çµ±è¨ˆæƒ…å ±å–å¾—ã«å¤±æ•—: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('çµ±è¨ˆæƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            showDataOperationStatus('error', 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
          })
          .getSpreadsheetStatistics();
      }

      function displayTimeSeriesData(timeSeriesData) {
        // æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡¨ç¤ºã™ã‚‹å‡¦ç†
        // å®Ÿè£…ã¯è¤‡é›‘ã«ãªã‚‹ãŸã‚ã€ã“ã“ã§ã¯åŸºæœ¬çš„ãªè¡¨ç¤ºã®ã¿
        console.log('æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿:', timeSeriesData);

        if (timeSeriesData.length === 0) {
          alert('æŒ‡å®šã—ãŸæŠ•ç¨¿æ—¥æ™‚ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
          return;
        }

        // æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        var latestData = timeSeriesData[timeSeriesData.length - 1];

        // ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ã‚’æ›´æ–°
        updateFollowerDisplay(latestData.followerCount, latestData.fetchTime);

        // æŠ•ç¨¿æ–‡ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡¨ç¤º
        var postTextCells = document.querySelectorAll('.post-text-row td.data-cell');
        if (postTextCells.length > 0 && latestData.text) {
          var fullText = latestData.text;
          var truncatedText = fullText.length > 25 ? fullText.substring(0, 25) + '...' : fullText;

          postTextCells[0].setAttribute('data-full-text', fullText);
          postTextCells[0].innerHTML = `
            <span class="truncated-text" onclick="showPostTextModal('${fullText.replace(/'/g, "\\'")}')">
              ${truncatedText}
            </span>
          `;
        }

        alert(
          `æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ:\n` +
            `æŠ•ç¨¿æ–‡: ${latestData.text.substring(0, 50)}...\n` +
            `ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³: ${latestData.impressions}\n` +
            `ã„ã„ã­: ${latestData.likes}\n` +
            `ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡: ${latestData.engagementRate}%`
        );
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã‚’ç¢ºèª
      window.onload = function () {
        initializeApplication();
        setupStickyColumns();
        setupDateColumns();
        setupScrollSync();
        
        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•ãƒ­ãƒ¼ãƒ‰
        loadInitialDataFromSpreadsheet();

        // ç¾åœ¨æ™‚åˆ»ã‚’æŠ•ç¨¿æ—¥æ™‚å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«è¨­å®š
        var now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('post-datetime-input').value = now.toISOString().slice(0, 16);
      };

      /**
       * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
       */
      function initializeApplication() {
        checkSystemStatus();
        checkApiKeyStatus();
        checkSpreadsheetIdStatus();
        checkBatchStatus();
      }

      /**
       * ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
       */
      function loadInitialDataFromSpreadsheet() {
        console.log('ğŸ“¥ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰é–‹å§‹');
        
        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success && result.data && result.data.length > 0) {
              console.log('âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ:', result.data.length + 'ä»¶');
              buildTableFromSpreadsheetData(result.data);
              // updatePostTextCells()ã¯buildTableFromSpreadsheetDataå†…ã§æ—¢ã«ã‚»ãƒ«ç”Ÿæˆæ™‚ã«å‡¦ç†æ¸ˆã¿
            } else {
              console.log('â„¹ï¸ ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ç©ºã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚');
              showEmptyTableMessage();
            }
          })
          .withFailureHandler(function (error) {
            console.error('âŒ ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            showEmptyTableMessage();
          })
          .getAllSpreadsheetData();
      }

      /**
       * ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ§‹ç¯‰
       */
      function buildTableFromSpreadsheetData(data) {
        try {
          console.log('ğŸ“Š ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹ç¯‰é–‹å§‹:', data);
          
          if (!data || data.length === 0) {
            console.log('âš ï¸ ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™');
            showEmptyTableMessage();
            return;
          }

          // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’æ§‹ç¯‰
          var headerRow = document.getElementById('table-header-row');
          if (!headerRow) {
            console.error('âŒ table-header-row ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            return;
          }
          
          headerRow.innerHTML = '<th>é …ç›® / æŠ•ç¨¿æ—¥æ™‚</th>';
          
          data.forEach(function (post, index) {
            try {
              var th = document.createElement('th');
              var postDate = new Date(post.timestamp);
              
              // æ—¥ä»˜ãŒç„¡åŠ¹ãªå ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
              if (isNaN(postDate.getTime())) {
                console.warn('ç„¡åŠ¹ãªæ—¥ä»˜:', post.timestamp);
                th.innerHTML = '-';
              } else {
                var dateStr = (postDate.getMonth() + 1) + '/' + postDate.getDate() + '<br />' +
                              postDate.getHours() + ':' + String(postDate.getMinutes()).padStart(2, '0');
                th.innerHTML = dateStr;
              }
              
              th.classList.add('date-column');
              headerRow.appendChild(th);
            } catch (headerError) {
              console.error('ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆã‚¨ãƒ©ãƒ¼ (æŠ•ç¨¿' + index + '):', headerError);
            }
          });
          
          console.log('âœ… ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œæ§‹ç¯‰å®Œäº†');

        // å„ãƒ¡ãƒˆãƒªãƒƒã‚¯è¡Œã«ã‚»ãƒ«ã‚’è¿½åŠ 
        var metrics = [
          { name: 'post_text', field: 'text' },
          { name: 'character_count', field: 'character_count' },
          { name: 'post_type', field: 'media_type' },
          { name: 'impressions', field: 'insights.views' },
          { name: 'likes', field: 'insights.likes' },
          { name: 'reposts', field: 'insights.reposts' },
          { name: 'replies', field: 'insights.replies' },
          { name: 'total_engagement', field: 'insights.total_engagement' },
          { name: 'engagement_rate', field: 'insights.engagement_rate' },
          { name: 'follower_count', field: 'insights.follower_count' }
        ];

          var tbody = document.getElementById('table-body');
          if (!tbody) {
            console.error('âŒ table-body ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            return;
          }
          
          var rows = tbody.querySelectorAll('tr');
          console.log('ğŸ“‹ ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œæ•°:', rows.length);
          
          metrics.forEach(function (metric, metricIndex) {
            try {
              var targetRow = null;
              
              // thã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰è¡Œã‚’æ¢ã™
              rows.forEach(function (row) {
                var th = row.querySelector('th');
                if (th) {
                  var thText = th.textContent.trim();
                  if (
                    (metric.name === 'post_text' && thText === 'æŠ•ç¨¿æ–‡') ||
                    (metric.name === 'character_count' && thText === 'æ–‡å­—æ•°') ||
                    (metric.name === 'post_type' && thText === 'ã‚¿ã‚¤ãƒ—') ||
                    (metric.name === 'impressions' && thText === 'ã‚¤ãƒ³ãƒ—(12h)') ||
                    (metric.name === 'likes' && thText === 'ã„ã„ã­(12h)') ||
                    (metric.name === 'reposts' && thText === 'å†æŠ•ç¨¿/å¼•ç”¨(12h)') ||
                    (metric.name === 'replies' && thText === 'ãƒªãƒ—ãƒ©ã‚¤(12h)') ||
                    (metric.name === 'total_engagement' && thText === 'Engç·æ•°(12h)') ||
                    (metric.name === 'engagement_rate' && thText === 'Engç‡(12h)') ||
                    (metric.name === 'follower_count' && thText === 'ç·ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼(12h)')
                  ) {
                    targetRow = row;
                  }
                }
              });

              if (targetRow) {
                // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã‚’è¿½åŠ 
                data.forEach(function (post, postIndex) {
                  try {
                    var td = document.createElement('td');
                    td.classList.add('data-cell');
                    td.setAttribute('data-metric', metric.name);
                    
                    var value = getNestedValue(post, metric.field);
                    
                    if (metric.name === 'post_text') {
                      var fullTextValue = value || '';
                      td.setAttribute('data-full-text', fullTextValue);
                      td.textContent = truncateText(fullTextValue, 50);
                      td.style.cursor = 'pointer';
                      td.style.color = '#1976d2';
                      td.title = 'ã‚¯ãƒªãƒƒã‚¯ã—ã¦å…¨æ–‡è¡¨ç¤º';
                      
                      // ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã§fullTextValueã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
                      (function(capturedText) {
                        td.onclick = function () {
                          showPostTextModal(capturedText);
                        };
                      })(fullTextValue);
                    } else if (metric.name === 'engagement_rate') {
                      td.textContent = value ? value.toFixed(2) + '%' : '-';
                    } else {
                      td.textContent = value !== null && value !== undefined ? value : '-';
                    }
                    
                    targetRow.appendChild(td);
                  } catch (cellError) {
                    console.error('ã‚»ãƒ«ç”Ÿæˆã‚¨ãƒ©ãƒ¼ (ãƒ¡ãƒˆãƒªãƒƒã‚¯:' + metric.name + ', æŠ•ç¨¿:' + postIndex + '):', cellError);
                  }
                });
              } else {
                console.warn('âš ï¸ è¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', metric.name);
              }
            } catch (metricError) {
              console.error('ãƒ¡ãƒˆãƒªãƒƒã‚¯å‡¦ç†ã‚¨ãƒ©ãƒ¼ (' + metric.name + '):', metricError);
            }
          });

          // colspan ã‚’æ›´æ–°
          updateColspans(data.length);
          
          console.log('âœ… ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹ç¯‰å®Œäº†');
          
        } catch (error) {
          console.error('âŒ ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹ç¯‰ã‚¨ãƒ©ãƒ¼:', error);
          showEmptyTableMessage();
        }
      }

      /**
       * ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å€¤ã‚’å–å¾—
       */
      function getNestedValue(obj, path) {
        return path.split('.').reduce(function (current, key) {
          return current && current[key] !== undefined ? current[key] : null;
        }, obj);
      }

      /**
       * ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ‡å®šæ–‡å­—æ•°ã§ãƒˆãƒ©ãƒ³ã‚±ãƒ¼ãƒˆ
       */
      function truncateText(text, maxLength) {
        if (!text) return '';
        if (text.length <= maxLength) return text;
        return text.substring(0, maxLength) + '...';
      }

      /**
       * colspanã‚’æ›´æ–°
       */
      function updateColspans(dataCount) {
        var colspan = dataCount + 1; // +1 for header column
        var freeHeader = document.getElementById('free-data-header');
        if (freeHeader) {
          freeHeader.setAttribute('colspan', colspan);
        }
        
        var premiumHeaders = document.querySelectorAll('.time-header-row.premium-row th');
        premiumHeaders.forEach(function (header) {
          header.setAttribute('colspan', colspan);
        });
        
        var spacerRows = document.querySelectorAll('.spacer-row td');
        spacerRows.forEach(function (cell) {
          cell.setAttribute('colspan', colspan);
        });
      }

      /**
       * ç©ºã®ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
       */
      function showEmptyTableMessage() {
        var tbody = document.getElementById('table-body');
        var messageRow = document.createElement('tr');
        var messageCell = document.createElement('td');
        messageCell.setAttribute('colspan', '10');
        messageCell.style.textAlign = 'center';
        messageCell.style.padding = '40px';
        messageCell.style.color = '#666';
        messageCell.innerHTML = 'ğŸ“­ ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“<br><br>ã€Œè¨­å®šã€ã‚¿ãƒ–ã§APIã‚­ãƒ¼ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’è¨­å®šå¾Œã€<br>ã€ŒğŸš€ ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜ã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚';
        messageRow.appendChild(messageCell);
        tbody.insertBefore(messageRow, tbody.firstChild);
      }

      /**
       * ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª
       */
      function checkSystemStatus() {
        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              const data = result.data;
              const statusText = document.getElementById('system-status-text');
              const statusIndicator = document.getElementById('system-status-indicator');

              if (data.systemReady) {
                statusText.textContent = 'âœ… ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†';
                statusIndicator.className = 'system-ready';
              } else {
                let missingItems = [];
                if (!data.apiKeyConfigured) missingItems.push('APIã‚­ãƒ¼');
                if (!data.spreadsheetConfigured) missingItems.push('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID');

                statusText.textContent = `âš ï¸ è¨­å®šãŒä¸å®Œå…¨ã§ã™ (æœªè¨­å®š: ${missingItems.join(', ')})`;
                statusIndicator.className = 'system-not-ready';
              }
            } else {
              document.getElementById('system-status-text').textContent = 'ã‚¨ãƒ©ãƒ¼: ' + result.message;
            }
          })
          .withFailureHandler(function (error) {
            console.error('ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
            document.getElementById('system-status-text').textContent = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
          })
          .getSystemStatus();
      }

      /**
       * ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–
       */
      function initializeDatabase() {
        if (!confirm('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ\næ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒã‚ã‚‹å ´åˆã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚')) {
          return;
        }

        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              alert('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–å®Œäº†ï¼\n\n' + result.message);
              checkSystemStatus();
            } else {
              alert('åˆæœŸåŒ–å¤±æ•—: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            alert('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
          })
          .initializeSpreadsheetDatabase();
      }

      /**
       * ãƒãƒƒãƒãƒˆãƒªã‚¬ãƒ¼è¨­å®š
       */
      function setupBatchTrigger() {
        if (!confirm('1æ™‚é–“æ¯ã®è‡ªå‹•ãƒ‡ãƒ¼ã‚¿åé›†ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ')) {
          return;
        }

        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              alert('è‡ªå‹•å®Ÿè¡Œã‚’é–‹å§‹ã—ã¾ã—ãŸï¼\n\n' + result.message);
              checkBatchStatus();
            } else {
              alert('è¨­å®šå¤±æ•—: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('ãƒãƒƒãƒãƒˆãƒªã‚¬ãƒ¼è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
            alert('è‡ªå‹•å®Ÿè¡Œè¨­å®šã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
          })
          .setupBatchTrigger();
      }

      /**
       * ãƒãƒƒãƒãƒˆãƒªã‚¬ãƒ¼åœæ­¢
       */
      function stopBatchTrigger() {
        if (!confirm('è‡ªå‹•ãƒ‡ãƒ¼ã‚¿åé›†ã‚’åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ')) {
          return;
        }

        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              alert('è‡ªå‹•å®Ÿè¡Œã‚’åœæ­¢ã—ã¾ã—ãŸã€‚\n\n' + result.message);
              checkBatchStatus();
            } else {
              alert('åœæ­¢å¤±æ•—: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('ãƒãƒƒãƒãƒˆãƒªã‚¬ãƒ¼åœæ­¢ã‚¨ãƒ©ãƒ¼:', error);
            alert('è‡ªå‹•å®Ÿè¡Œåœæ­¢ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
          })
          .removeBatchTrigger();
      }

      /**
       * ãƒãƒƒãƒçŠ¶æ…‹ç¢ºèª
       */
      function checkBatchStatus() {
        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              const data = result.data;
              const indicator = document.getElementById('batch-status-indicator');

              if (data.isActive) {
                indicator.textContent = 'âœ… è‡ªå‹•å®Ÿè¡Œä¸­ (1æ™‚é–“æ¯)';
                indicator.style.color = '#2e7d32';
              } else {
                indicator.textContent = 'âŒ è‡ªå‹•å®Ÿè¡Œåœæ­¢ä¸­';
                indicator.style.color = '#d32f2f';
              }
            } else {
              document.getElementById('batch-status-indicator').textContent = 'ã‚¨ãƒ©ãƒ¼: ' + result.message;
            }
          })
          .withFailureHandler(function (error) {
            console.error('ãƒãƒƒãƒçŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
            document.getElementById('batch-status-indicator').textContent = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
          })
          .getBatchTriggerStatus();
      }

      /**
       * ãƒãƒƒãƒå®Ÿè¡ŒçŠ¶æ³ç¢ºèªï¼ˆæ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤ºï¼‰
       */
      function getBatchStatus() {
        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              const data = result.data;
              const stats = data.statistics;
              const health = data.systemHealth;

              let message = `ãƒãƒƒãƒå®Ÿè¡Œçµ±è¨ˆ (éå»30æ—¥é–“)\n\n`;
              message += `ç·å®Ÿè¡Œå›æ•°: ${stats.totalExecutions}å›\n`;
              message += `æˆåŠŸ: ${stats.successfulExecutions}å›\n`;
              message += `å¤±æ•—: ${stats.failedExecutions}å›\n`;
              message += `ã‚¨ãƒ©ãƒ¼ç‡: ${stats.errorRate.toFixed(1)}%\n`;
              message += `å¹³å‡å‡¦ç†æŠ•ç¨¿æ•°: ${stats.averagePostsProcessed.toFixed(1)}ä»¶\n`;
              message += `å¹³å‡å®Ÿè¡Œæ™‚é–“: ${(stats.averageExecutionTime / 1000).toFixed(1)}ç§’\n`;

              if (stats.lastExecution) {
                message += `æœ€çµ‚å®Ÿè¡Œ: ${new Date(stats.lastExecution).toLocaleString()}\n`;
              }

              message += `\nã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§: ${health.isHealthy ? 'âœ… æ­£å¸¸' : 'âš ï¸ æ³¨æ„ãŒå¿…è¦'}`;

              if (health.consecutiveFailures > 0) {
                message += `\né€£ç¶šå¤±æ•—: ${health.consecutiveFailures}å›`;
              }

              alert(message);
            } else {
              alert('ãƒãƒƒãƒçŠ¶æ³å–å¾—å¤±æ•—: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('ãƒãƒƒãƒçŠ¶æ³ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
            alert('ãƒãƒƒãƒçŠ¶æ³ç¢ºèªã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
          })
          .getBatchExecutionStatus();
      }

      /**
       * ãƒãƒƒãƒå®Ÿè¡ŒçŠ¶æ³ã‚’æ›´æ–°ï¼ˆè©³ç´°è¡¨ç¤ºç‰ˆï¼‰
       */
      function refreshBatchStatus() {
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        document.getElementById('batch-statistics').style.display = 'none';
        document.getElementById('batch-recent-logs').style.display = 'none';

        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              const data = result.data;
              const stats = data.statistics;
              const health = data.systemHealth;
              const logs = data.recentLogs || [];

              // çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤º
              document.getElementById('stat-total-executions').textContent = stats.totalExecutions;
              document.getElementById('stat-successful-executions').textContent = stats.successfulExecutions;
              document.getElementById('stat-failed-executions').textContent = stats.failedExecutions;
              document.getElementById('stat-error-rate').textContent = stats.errorRate.toFixed(2);
              document.getElementById('stat-avg-posts').textContent = stats.averagePostsProcessed;
              document.getElementById('stat-avg-time').textContent = stats.averageExecutionTime;
              document.getElementById('stat-last-execution').textContent = stats.lastExecution 
                ? new Date(stats.lastExecution).toLocaleString() 
                : 'æœªå®Ÿè¡Œ';

              // ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§ã‚’è¡¨ç¤º
              const healthStatus = document.getElementById('stat-health-status');
              if (health.isHealthy) {
                healthStatus.innerHTML = '<span style="color: #28a745;">âœ… æ­£å¸¸</span>';
              } else {
                healthStatus.innerHTML = `<span style="color: #dc3545;">âš ï¸ æ³¨æ„ (é€£ç¶šå¤±æ•—: ${health.consecutiveFailures}å›)</span>`;
              }

              // çµ±è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
              document.getElementById('batch-statistics').style.display = 'block';

              // ãƒ­ã‚°ã‚’è¡¨ç¤º
              if (logs.length > 0) {
                const logsContainer = document.getElementById('batch-logs-container');
                logsContainer.innerHTML = '';

                logs.forEach(log => {
                  const logEntry = document.createElement('div');
                  logEntry.style.cssText = 'padding: 8px; margin-bottom: 8px; border-left: 3px solid #dee2e6; background: #f8f9fa; font-size: 13px;';

                  // ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦è‰²ã‚’å¤‰æ›´
                  let levelColor = '#6c757d';
                  if (log.logLevel === 'SUCCESS') levelColor = '#28a745';
                  else if (log.logLevel === 'ERROR') levelColor = '#dc3545';
                  else if (log.logLevel === 'WARNING') levelColor = '#ffc107';
                  logEntry.style.borderLeftColor = levelColor;

                  const timestamp = new Date(log.timestamp).toLocaleString();
                  const executionTime = log.executionTime ? `${log.executionTime}ms` : '-';

                  logEntry.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                      <span style="font-weight: bold; color: ${levelColor};">[${log.logLevel}]</span>
                      <span style="font-size: 11px; color: #6c757d;">${timestamp}</span>
                    </div>
                    <div style="margin-bottom: 4px;">${log.message}</div>
                    <div style="font-size: 11px; color: #6c757d;">
                      å‡¦ç†ä»¶æ•°: ${log.postsProcessed}ä»¶ | å®Ÿè¡Œæ™‚é–“: ${executionTime}
                      ${log.errorDetails ? ` | ã‚¨ãƒ©ãƒ¼: ${log.errorDetails}` : ''}
                    </div>
                  `;

                  logsContainer.appendChild(logEntry);
                });

                document.getElementById('batch-recent-logs').style.display = 'block';
              }

              console.log('ãƒãƒƒãƒå®Ÿè¡ŒçŠ¶æ³ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            } else {
              alert('ãƒãƒƒãƒçŠ¶æ³å–å¾—å¤±æ•—: ' + result.message);
            }
          })
          .withFailureHandler(function (error) {
            console.error('ãƒãƒƒãƒçŠ¶æ³ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
            alert('ãƒãƒƒãƒçŠ¶æ³ç¢ºèªã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
          })
          .getBatchExecutionStatus();
      }

    </script>
  </body>
</html>
