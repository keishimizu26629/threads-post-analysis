# ThreadsæŠ•ç¨¿åˆ†æãƒ„ãƒ¼ãƒ« - æŠ€è¡“ä»•æ§˜æ›¸

## ğŸ“‹ æ¦‚è¦

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
**ThreadsæŠ•ç¨¿åˆ†æãƒ„ãƒ¼ãƒ« (Threads Post Analysis Tool)**

### ç›®çš„
Threadsï¼ˆMetaï¼‰ã®æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚’å®šæœŸçš„ã«åé›†ãƒ»åˆ†æã—ã€ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆæŒ‡æ¨™ã‚’å¯è¦–åŒ–ã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼
- Threadsã§SNSãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†å€‹äººãƒ»ä¼æ¥­
- æŠ•ç¨¿ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ•°å€¤ã§è¿½è·¡ã—ãŸã„ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼

---

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ HTTPS
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Frontend: Google Apps Script Web App         â”‚
â”‚    - dashboard.html (UI)                        â”‚
â”‚    - JavaScript (Client-side)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ google.script.run
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Backend: Google Apps Script (TypeScript)     â”‚
â”‚    - Code.ts (Main Entry)                       â”‚
â”‚    - threadsApi.ts (API Communication)          â”‚
â”‚    - dataProcessor.ts (Data Analysis)           â”‚
â”‚    - spreadsheetManager.ts (DB Operations)      â”‚
â”‚    - triggerManager.ts (Batch Jobs)             â”‚
â”‚    - reportGenerator.ts (Report Creation)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            â”‚            â”‚
    â†“            â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Threads â”‚ â”‚ Props   â”‚ â”‚ Google Sheets   â”‚
â”‚   API   â”‚ â”‚ Service â”‚ â”‚   (Database)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  å¤–éƒ¨API      è¨­å®šä¿å­˜     ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
```

---

## ğŸ–¥ï¸ Frontendä»•æ§˜ï¼ˆGAS Webã‚¢ãƒ—ãƒªï¼‰

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **HTML5**: æ§‹é€ 
- **CSS3**: ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ï¼ˆMaterial Designé¢¨ï¼‰
- **Vanilla JavaScript**: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
- **GAS Client API**: `google.script.run` ã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰é–¢æ•°å‘¼ã³å‡ºã—

### ç”»é¢æ§‹æˆ

#### 1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ–
**ç›®çš„**: ç¾åœ¨ã®çŠ¶æ…‹è¡¨ç¤ºã¨ä¸»è¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

| è¦ç´  | èª¬æ˜ | æ©Ÿèƒ½ |
|------|------|------|
| ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°è¡¨ç¤º | æœ€æ–°ã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ã‚’å¤§ããè¡¨ç¤º | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å–å¾— |
| åˆ†æå®Ÿè¡Œãƒœã‚¿ãƒ³ | æ‰‹å‹•ã§ãƒãƒƒãƒåˆ†æã‚’å®Ÿè¡Œ | `runAnalysis()` å‘¼ã³å‡ºã— |
| æœ€çµ‚æ›´æ–°æ—¥æ™‚ | æœ€å¾Œã«åˆ†æã—ãŸæ—¥æ™‚ã‚’è¡¨ç¤º | PropertiesServiceã‹ã‚‰å–å¾— |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º | å®Ÿè¡Œä¸­/å®Œäº†/ã‚¨ãƒ©ãƒ¼ã®çŠ¶æ…‹ | éåŒæœŸå‡¦ç†ã®é€²æ— |

#### 2. ãƒ‡ãƒ¼ã‚¿ã‚¿ãƒ–ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
**ç›®çš„**: æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã®ä¸€è¦§è¡¨ç¤º

**ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ**:

| ã‚«ãƒ©ãƒ å | èª¬æ˜ | ãƒ‡ãƒ¼ã‚¿å‹ | è¡¨ç¤ºå½¢å¼ |
|---------|------|---------|---------|
| æŠ•ç¨¿æ—¥æ™‚ | æŠ•ç¨¿ãŒå…¬é–‹ã•ã‚ŒãŸæ—¥æ™‚ | DateTime | `YYYY-MM-DD HH:mm` |
| æŠ•ç¨¿æ–‡ | æŠ•ç¨¿ã®ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹ | String | æœ€å¤§50æ–‡å­—ï¼ˆä»¥é™ã¯çœç•¥ï¼‰ |
| æ–‡å­—æ•° | æŠ•ç¨¿ã®æ–‡å­—æ•° | Number | æ•´æ•° |
| ã‚¿ã‚¤ãƒ— | æŠ•ç¨¿ã‚¿ã‚¤ãƒ— | String | `TEXT`, `IMAGE`, `VIDEO`, `CAROUSEL` |
| ã„ã„ã­ (12h) | 12æ™‚é–“å¾Œã®ã„ã„ã­æ•° | Number | ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š |
| ãƒªãƒ—ãƒ©ã‚¤ (12h) | 12æ™‚é–“å¾Œã®ãƒªãƒ—ãƒ©ã‚¤æ•° | Number | ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š |
| ã‚·ã‚§ã‚¢ (12h) | 12æ™‚é–“å¾Œã®ã‚·ã‚§ã‚¢æ•° | Number | ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š |
| ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ (12h) | 12æ™‚é–“å¾Œã®ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ•° | Number | ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š |
| ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡ | `(ã„ã„ã­+ãƒªãƒ—ãƒ©ã‚¤+ã‚·ã‚§ã‚¢) / ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ Ã— 100` | Number | ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆï¼ˆå°æ•°ç‚¹1æ¡ï¼‰ |

**æ©Ÿèƒ½**:
- **ã‚½ãƒ¼ãƒˆ**: å„ã‚«ãƒ©ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã§æ˜‡é †/é™é †åˆ‡ã‚Šæ›¿ãˆ
- **ãƒã‚¤ãƒ©ã‚¤ãƒˆ**: å¹³å‡å€¤ã‚’è¶…ãˆã‚‹æ•°å€¤ã‚’ç·‘èƒŒæ™¯ã§å¼·èª¿
- **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**: 1ãƒšãƒ¼ã‚¸50ä»¶è¡¨ç¤º
- **æ¤œç´¢**: æŠ•ç¨¿æ–‡ã§çµã‚Šè¾¼ã¿

#### 3. è¨­å®šã‚¿ãƒ–
**ç›®çš„**: APIè¨­å®šã¨ã‚·ã‚¹ãƒ†ãƒ è¨­å®š

| é …ç›® | èª¬æ˜ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
|------|------|--------------|
| Threads API Key | Threads APIã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ | å¿…é ˆã€ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯ |
| Threads User ID | åˆ†æå¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID | å¿…é ˆã€æ•°å€¤ã®ã¿ |
| Spreadsheet ID | ãƒ‡ãƒ¼ã‚¿ä¿å­˜å…ˆã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID | å¿…é ˆã€20æ–‡å­—ä»¥ä¸Šã€è‹±æ•°å­—ãƒ»è¨˜å·ã®ã¿ |
| ãƒã‚¤ãƒ©ã‚¤ãƒˆé–¾å€¤ | å¹³å‡å€¤ã®ä½•%ä»¥ä¸Šã‚’å¼·èª¿ã™ã‚‹ã‹ | 0-200%ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ100%ï¼‰ |

**ä¿å­˜ãƒœã‚¿ãƒ³**: å„é …ç›®ã®ä¿å­˜ãƒœã‚¿ãƒ³ã§ `PropertiesService` ã«ä¿å­˜

#### 4. ãƒ¬ãƒãƒ¼ãƒˆã‚¿ãƒ–ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆï¼‰
**ç›®çš„**: æœˆæ¬¡ã‚µãƒãƒªãƒ¼ã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°

| ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|-----------|------|
| æœˆé–“ã‚µãƒãƒªãƒ¼ | æŠ•ç¨¿æ•°ã€å¹³å‡ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡ã€ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼å¢—åŠ æ•° |
| äººæ°—æŠ•ç¨¿Top10 | ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡ãŒé«˜ã„æŠ•ç¨¿ |
| æŠ•ç¨¿æ™‚é–“å¸¯åˆ†æ | æ›œæ—¥ãƒ»æ™‚é–“å¸¯åˆ¥ã®å¹³å‡ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡ |
| ãƒˆãƒ¬ãƒ³ãƒ‰æ¨ç§» | éå»3ãƒ¶æœˆã®æ¨ç§»ã‚°ãƒ©ãƒ• |

---

## ğŸ”§ Backendä»•æ§˜ï¼ˆGoogle Apps Scriptï¼‰

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **è¨€èª**: TypeScriptï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«â†’JavaScriptï¼‰
- **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ **: Google Apps Script V8
- **ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«**: claspï¼ˆGoogleå…¬å¼CLIï¼‰
- **ä¾å­˜é–¢ä¿‚ç®¡ç†**: npmï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/
â”œâ”€â”€ appsscript.json          # GASè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ Code.ts                  # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆãƒ»doGet/doPost
â”œâ”€â”€ types.ts                 # å‹å®šç¾©
â”œâ”€â”€ dashboard.html           # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”œâ”€â”€ threadsApi.ts            # Threads APIé€šä¿¡
â”œâ”€â”€ dataProcessor.ts         # ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»åŠ å·¥
â”œâ”€â”€ spreadsheetManager.ts    # ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ“ä½œ
â”œâ”€â”€ dataManager.ts           # PropertiesServiceç®¡ç†
â”œâ”€â”€ triggerManager.ts        # ãƒˆãƒªã‚¬ãƒ¼ï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ï¼‰ç®¡ç†
â”œâ”€â”€ reportGenerator.ts       # ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
â””â”€â”€ gasUtils.ts              # æ±ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
```

### ä¸»è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä»•æ§˜

#### 1. Code.tsï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼‰

**å½¹å‰²**: Webã‚¢ãƒ—ãƒªã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€å¤–éƒ¨ã‹ã‚‰ã®å‘¼ã³å‡ºã—ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
// Webã‚¢ãƒ—ãƒªè¡¨ç¤º
function doGet(e: GoogleAppsScript.Events.DoGet): GoogleAppsScript.HTML.HtmlOutput

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
function doPost(e: GoogleAppsScript.Events.DoPost): GoogleAppsScript.Content.TextOutput

// APIè¨­å®šä¿å­˜
function saveApiKey(apiKey: string): { success: boolean; message: string }
function saveUserId(userId: string): { success: boolean; message: string }
function saveSpreadsheetId(spreadsheetId: string): { success: boolean; message: string }

// è¨­å®šå–å¾—
function getApiKey(): string
function getUserId(): string
function getSpreadsheetId(): string | null

// åˆ†æå®Ÿè¡Œ
function runAnalysis(): { success: boolean; message: string; data?: any }
function getLatestData(): any[]
function getFollowerCount(): number
```

#### 2. threadsApi.tsï¼ˆThreads APIé€šä¿¡ï¼‰

**å½¹å‰²**: Threads Graph APIã¨ã®é€šä¿¡

```typescript
class ThreadsApi {
  private apiKey: string;
  private userId: string;
  
  constructor(apiKey: string, userId: string);
  
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
  getUserProfile(): {
    id: string;
    username: string;
    followers_count: number;
    profile_picture_url: string;
  }
  
  // æŠ•ç¨¿ä¸€è¦§å–å¾—ï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
  getThreads(limit: number = 100, before?: string): {
    data: Thread[];
    paging?: {
      cursors: {
        before: string;
        after: string;
      };
    };
  }
  
  // æŠ•ç¨¿è©³ç´°å–å¾—ï¼ˆã‚¤ãƒ³ã‚µã‚¤ãƒˆå«ã‚€ï¼‰
  getThreadInsights(threadId: string): {
    id: string;
    text: string;
    timestamp: string;
    media_type: 'TEXT' | 'IMAGE' | 'VIDEO' | 'CAROUSEL';
    likes_count: number;
    replies_count: number;
    reposts_count: number;
    impressions: number;
    engagement_rate: number;
  }
  
  // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å‡¦ç†
  private waitForRateLimit(): void;
  
  // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  private handleApiError(error: any): void;
}
```

**APIä»•æ§˜**:
- **ãƒ™ãƒ¼ã‚¹URL**: `https://graph.threads.net/v1.0`
- **èªè¨¼**: Bearerãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆAPIã‚­ãƒ¼ï¼‰
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: 200ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“
- **ãƒªãƒˆãƒ©ã‚¤**: 429ã‚¨ãƒ©ãƒ¼æ™‚ã¯60ç§’å¾…æ©Ÿ

#### 3. spreadsheetManager.tsï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ“ä½œï¼‰

**å½¹å‰²**: Google Sheetsã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦æ“ä½œ

```typescript
class SpreadsheetManager {
  private spreadsheetId: string;
  private sheet: GoogleAppsScript.Spreadsheet.Sheet;
  
  constructor(spreadsheetId: string);
  
  // ã‚·ãƒ¼ãƒˆåˆæœŸåŒ–ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ä½œæˆï¼‰
  initializeSheet(sheetName: string): void;
  
  // ãƒ‡ãƒ¼ã‚¿è¿½åŠ ï¼ˆè¡Œå˜ä½ï¼‰
  appendRow(data: any[]): void;
  
  // ãƒ‡ãƒ¼ã‚¿æ›´æ–°ï¼ˆæ—¢å­˜è¡Œï¼‰
  updateRow(rowIndex: number, data: any[]): void;
  
  // ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆå…¨ä»¶ï¼‰
  getAllData(): any[][];
  
  // ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆæ¡ä»¶ä»˜ãï¼‰
  getDataByDate(startDate: Date, endDate: Date): any[][];
  
  // æŠ•ç¨¿IDã§æ¤œç´¢
  findRowByThreadId(threadId: string): number | null;
  
  // ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
  deleteRow(rowIndex: number): void;
  
  // ã‚·ãƒ¼ãƒˆã‚¯ãƒªã‚¢
  clearSheet(keepHeader: boolean = true): void;
  
  // ãƒãƒƒãƒæ›¸ãè¾¼ã¿ï¼ˆé«˜é€ŸåŒ–ï¼‰
  batchWrite(data: any[][]): void;
}
```

**ã‚·ãƒ¼ãƒˆæ§‹æˆ**:

| ã‚·ãƒ¼ãƒˆå | èª¬æ˜ | ã‚«ãƒ©ãƒ  |
|---------|------|--------|
| `posts` | æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ | thread_id, timestamp, text, char_count, media_type, likes_12h, replies_12h, shares_12h, impressions_12h, engagement_rate, likes_24h, replies_24h, shares_24h, impressions_24h, likes_72h, replies_72h, shares_72h, impressions_72h, likes_7d, replies_7d, shares_7d, impressions_7d |
| `profile` | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ± | date, followers_count, username, profile_url |
| `config` | ã‚·ã‚¹ãƒ†ãƒ è¨­å®š | key, value, updated_at |
| `logs` | å®Ÿè¡Œãƒ­ã‚° | timestamp, level, message, error |

#### 4. dataProcessor.tsï¼ˆãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»åŠ å·¥ï¼‰

**å½¹å‰²**: å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®åŠ å·¥ãƒ»åˆ†æ

```typescript
class DataProcessor {
  // ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡è¨ˆç®—
  calculateEngagementRate(likes: number, replies: number, shares: number, impressions: number): number;
  
  // å¹³å‡å€¤è¨ˆç®—
  calculateAverages(data: any[]): {
    avgLikes: number;
    avgReplies: number;
    avgShares: number;
    avgEngagementRate: number;
  }
  
  // ãƒã‚¤ãƒ©ã‚¤ãƒˆå¯¾è±¡åˆ¤å®š
  shouldHighlight(value: number, average: number, threshold: number = 1.0): boolean;
  
  // æŠ•ç¨¿ã‚¿ã‚¤ãƒ—åˆ¤å®š
  detectMediaType(text: string, mediaUrl?: string): 'TEXT' | 'IMAGE' | 'VIDEO' | 'CAROUSEL';
  
  // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆï¼ˆçµµæ–‡å­—å¯¾å¿œï¼‰
  countCharacters(text: string): number;
  
  // æŠ•ç¨¿æ™‚é–“å¸¯åˆ†æ
  analyzePostingTimes(data: any[]): {
    byHour: { [hour: string]: number };
    byDay: { [day: string]: number };
  }
  
  // ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
  analyzeTrend(data: any[], metric: string): {
    trend: 'up' | 'down' | 'stable';
    changeRate: number;
  }
}
```

#### 5. triggerManager.tsï¼ˆãƒˆãƒªã‚¬ãƒ¼ç®¡ç†ï¼‰

**å½¹å‰²**: å®šæœŸå®Ÿè¡Œã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°

```typescript
class TriggerManager {
  // æ—¥æ¬¡ãƒˆãƒªã‚¬ãƒ¼è¨­å®šï¼ˆæ¯æ—¥9:00ï¼‰
  static setupDailyTrigger(functionName: string, hour: number): void;
  
  // é€±æ¬¡ãƒˆãƒªã‚¬ãƒ¼è¨­å®šï¼ˆæœˆæ›œ10:00ï¼‰
  static setupWeeklyTrigger(functionName: string, weekDay: GoogleAppsScript.Script.WeekDay, hour: number): void;
  
  // æœˆæ¬¡ãƒˆãƒªã‚¬ãƒ¼è¨­å®šï¼ˆ1æ—¥10:00ï¼‰
  static setupMonthlyTrigger(functionName: string, dayOfMonth: number, hour: number): void;
  
  // æ—¢å­˜ãƒˆãƒªã‚¬ãƒ¼å‰Šé™¤
  static deleteTrigger(functionName: string): void;
  
  // å…¨ãƒˆãƒªã‚¬ãƒ¼ä¸€è¦§å–å¾—
  static listAllTriggers(): GoogleAppsScript.Script.Trigger[];
  
  // ãƒˆãƒªã‚¬ãƒ¼å‰Šé™¤ï¼ˆå…¨ã¦ï¼‰
  static deleteAllTriggers(): void;
}
```

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š**:
- **æ—¥æ¬¡ãƒãƒƒãƒ**: æ¯æ—¥9:00ã« `runDailyAnalysis()` å®Ÿè¡Œ
- **é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ**: æœˆæ›œ10:00ã« `generateWeeklyReport()` å®Ÿè¡Œ
- **æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ**: æ¯æœˆ1æ—¥10:00ã« `generateMonthlyReport()` å®Ÿè¡Œ

#### 6. reportGenerator.tsï¼ˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼‰

**å½¹å‰²**: åˆ†æãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ

```typescript
class ReportGenerator {
  // é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
  generateWeeklyReport(startDate: Date, endDate: Date): {
    totalPosts: number;
    averageEngagement: number;
    topPost: any;
    followerGrowth: number;
  }
  
  // æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
  generateMonthlyReport(year: number, month: number): {
    totalPosts: number;
    averageEngagement: number;
    topPosts: any[];
    postingTimeAnalysis: any;
    trend: any;
  }
  
  // ãƒ¬ãƒãƒ¼ãƒˆã‚’HTMLã§å‡ºåŠ›
  exportToHtml(report: any): string;
  
  // ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ¡ãƒ¼ãƒ«é€ä¿¡
  sendReportEmail(recipient: string, report: any): void;
}
```

#### 7. gasUtils.tsï¼ˆæ±ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼‰

```typescript
// PropertiesServiceå®‰å…¨æ“ä½œ
function getPropertySafely(key: string, defaultValue?: string): string;
function setPropertySafely(key: string, value: string): boolean;
function deletePropertySafely(key: string): boolean;

// æ—¥æ™‚æ“ä½œ
function formatDate(date: Date, format: string): string;
function addHours(date: Date, hours: number): Date;
function isWithinTimeRange(date: Date, startDate: Date, endDate: Date): boolean;

// ãƒ­ã‚°å‡ºåŠ›
function logInfo(message: string): void;
function logError(message: string, error: any): void;
function logWarning(message: string): void;

// ãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
function validateApiKey(apiKey: string): boolean;
function validateSpreadsheetId(id: string): boolean;
function validateUserId(userId: string): boolean;
```

---

## ğŸ—„ï¸ Databaseä»•æ§˜ï¼ˆGoogle Sheetsï¼‰

### ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ§‹æˆ

#### ğŸ¯ æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿åé›†ã®è¨­è¨ˆæ€æƒ³

ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€**æŠ•ç¨¿ã”ã¨ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’1æ™‚é–“å˜ä½ã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜**ã™ã‚‹è¨­è¨ˆã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ… æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ•ãŒç°¡å˜ã«ä½œæˆã§ãã‚‹
- âœ… ä»»æ„ã®æ™‚ç‚¹ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å–å¾—å¯èƒ½
- âœ… ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ã®æ¨ç§»ã¨æŠ•ç¨¿ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ç›¸é–¢åˆ†æãŒå¯èƒ½
- âœ… å¾Œã‹ã‚‰BigQuery/Firestoreã¸ã®ç§»è¡ŒãŒå®¹æ˜“

**ãƒ‡ãƒ¼ã‚¿ä¿å­˜æœŸé–“**: éå»7æ—¥åˆ†ï¼ˆè‡ªå‹•å‰Šé™¤ï¼‰

---

#### ã‚·ãƒ¼ãƒˆ: `posts`ï¼ˆæŠ•ç¨¿ãƒã‚¹ã‚¿ï¼‰

**å½¹å‰²**: æŠ•ç¨¿ã®åŸºæœ¬æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ãƒã‚¹ã‚¿ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ  | åˆ—å | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ | ä¾‹ |
|-------|------|---------|------|-----|
| A | post_id | String | æŠ•ç¨¿ã®ä¸€æ„IDï¼ˆThreads APIï¼‰ | `1234567890123456789` |
| B | platform | String | ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å | `threads` |
| C | account_id | String | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID | `987654321` |
| D | posted_at | DateTime | æŠ•ç¨¿æ—¥æ™‚ï¼ˆJSTï¼‰ | `2024-11-27 14:30:00` |
| E | content | String | æŠ•ç¨¿ãƒ†ã‚­ã‚¹ãƒˆ | `ã“ã‚“ã«ã¡ã¯ï¼ä»Šæ—¥ã¯...` |
| F | url | String | æŠ•ç¨¿URL | `https://threads.net/@user/post/123...` |
| G | char_count | Number | æ–‡å­—æ•° | `120` |
| H | media_type | String | ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ— | `TEXT`, `IMAGE`, `VIDEO`, `CAROUSEL` |
| I | hashtags | String | ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ | `#ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°,#SNS` |
| J | created_at | DateTime | ãƒ‡ãƒ¼ã‚¿ä½œæˆæ—¥æ™‚ | `2024-11-27 14:35:00` |
| K | updated_at | DateTime | ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ—¥æ™‚ | `2024-11-27 15:00:00` |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: `post_id` (PRIMARY KEY)

**ãƒ‡ãƒ¼ã‚¿è¿½åŠ ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: 
- 1æ™‚é–“ã”ã¨ã®å®šæœŸå®Ÿè¡Œæ™‚ã«æ–°è¦æŠ•ç¨¿ã‚’æ¤œçŸ¥
- æ‰‹å‹•ã§ã€Œåˆ†æå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚

---

#### ã‚·ãƒ¼ãƒˆ: `post_metrics_hourly`ï¼ˆæ™‚ç³»åˆ—æŠ•ç¨¿ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼‰

**å½¹å‰²**: æŠ•ç¨¿ã”ã¨ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’1æ™‚é–“å˜ä½ã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜

| ã‚«ãƒ©ãƒ  | åˆ—å | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ | ä¾‹ |
|-------|------|---------|------|-----|
| A | post_id | String | postsãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤–éƒ¨ã‚­ãƒ¼ | `1234567890123456789` |
| B | captured_at | DateTime | å–å¾—æ™‚åˆ»ï¼ˆ1æ™‚é–“å˜ä½ã«ä¸¸ã‚ã‚‹ï¼‰ | `2024-11-27 15:00:00` |
| C | impressions | Number | ç´¯è¨ˆã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ•° | `1250` |
| D | likes | Number | ã„ã„ã­æ•° | `45` |
| E | comments | Number | ã‚³ãƒ¡ãƒ³ãƒˆæ•°ï¼ˆãƒªãƒ—ãƒ©ã‚¤æ•°ï¼‰ | `8` |
| F | shares | Number | ã‚·ã‚§ã‚¢æ•°ï¼ˆå¼•ç”¨æŠ•ç¨¿æ•°ï¼‰ | `3` |
| G | follower_count | Number | å–å¾—æ™‚ç‚¹ã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•° | `1520` |
| H | account_id | String | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDï¼ˆJOINå¯¾ç­–ï¼‰ | `987654321` |
| I | engagement_rate | Number | ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡ï¼ˆ%ï¼‰ | `4.48` |
| J | hours_since_post | Number | æŠ•ç¨¿ã‹ã‚‰ã®çµŒéæ™‚é–“ | `12` |

**è¤‡åˆã‚­ãƒ¼**: `post_id` + `captured_at` (UNIQUE)

**ãƒ‡ãƒ¼ã‚¿è¿½åŠ ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: 
- **1æ™‚é–“ã”ã¨ã®å®šæœŸå®Ÿè¡Œ**: éå»7æ—¥ä»¥å†…ã®å…¨æŠ•ç¨¿ã®æœ€æ–°ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å–å¾—
- **é‡è¤‡ãƒã‚§ãƒƒã‚¯**: åŒã˜ `post_id` Ã— `captured_at` ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ä¸Šæ›¸ã

**ãƒ‡ãƒ¼ã‚¿ä¿å­˜æœŸé–“**: éå»7æ—¥åˆ†ï¼ˆ7æ—¥ã‚ˆã‚Šå¤ã„ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•å‰Šé™¤ï¼‰

**æ™‚åˆ»ã®ä¸¸ã‚å‡¦ç†**:
```javascript
// 2024-11-27 14:35:23 â†’ 2024-11-27 14:00:00
function truncateToHour(date) {
  const d = new Date(date);
  d.setMinutes(0, 0, 0);
  return d;
}
```

---

#### ã‚·ãƒ¼ãƒˆ: `account_metrics_hourly`ï¼ˆæ™‚ç³»åˆ—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼‰â€»ä»»æ„

**å½¹å‰²**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå…¨ä½“ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’1æ™‚é–“å˜ä½ã§è¨˜éŒ²

| ã‚«ãƒ©ãƒ  | åˆ—å | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ | ä¾‹ |
|-------|------|---------|------|-----|
| A | account_id | String | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID | `987654321` |
| B | captured_at | DateTime | å–å¾—æ™‚åˆ»ï¼ˆ1æ™‚é–“å˜ä½ï¼‰ | `2024-11-27 15:00:00` |
| C | follower_count | Number | ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•° | `1520` |
| D | total_impressions | Number | 1æ™‚é–“ã§ç™ºç”Ÿã—ãŸåˆè¨ˆã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ | `3500` |
| E | profile_views | Number | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ“ãƒ¥ãƒ¼æ•° | `120` |
| F | total_posts | Number | ç´¯è¨ˆæŠ•ç¨¿æ•° | `450` |

**ã‚­ãƒ¼**: `account_id` + `captured_at`

---

#### ã‚·ãƒ¼ãƒˆ: `profile`ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ï¼‰â€»ãƒ¬ã‚¬ã‚·ãƒ¼

**å½¹å‰²**: æ—¥æ¬¡ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚’ä¿å­˜ï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰

| ã‚«ãƒ©ãƒ  | åˆ—å | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ | ä¾‹ |
|-------|------|---------|------|-----|
| A | date | Date | è¨˜éŒ²æ—¥ | `2024-11-27` |
| B | followers_count | Number | ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•° | `1520` |
| C | username | String | ãƒ¦ãƒ¼ã‚¶ãƒ¼å | `@example` |
| D | profile_url | String | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«URL | `https://threads.net/@example` |

---

#### ã‚·ãƒ¼ãƒˆ: `config`ï¼ˆã‚·ã‚¹ãƒ†ãƒ è¨­å®šï¼‰

| ã‚«ãƒ©ãƒ  | åˆ—å | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ | ä¾‹ |
|-------|------|---------|------|-----|
| A | key | String | è¨­å®šã‚­ãƒ¼ | `last_run_time` |
| B | value | String | è¨­å®šå€¤ | `2024-11-27 15:00:00` |
| C | updated_at | DateTime | æ›´æ–°æ—¥æ™‚ | `2024-11-27 15:00:00` |

**è¨­å®šã‚­ãƒ¼ä¸€è¦§**:
- `last_run_time`: æœ€çµ‚å®Ÿè¡Œæ™‚åˆ»
- `avg_likes`: å¹³å‡ã„ã„ã­æ•°
- `avg_engagement_rate`: å¹³å‡ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡
- `data_retention_days`: ãƒ‡ãƒ¼ã‚¿ä¿å­˜æœŸé–“ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 7æ—¥ï¼‰

---

#### ã‚·ãƒ¼ãƒˆ: `logs`ï¼ˆå®Ÿè¡Œãƒ­ã‚°ï¼‰

| ã‚«ãƒ©ãƒ  | åˆ—å | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ | ä¾‹ |
|-------|------|---------|------|-----|
| A | timestamp | DateTime | ãƒ­ã‚°æ—¥æ™‚ | `2024-11-27 15:00:15` |
| B | level | String | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« | `INFO`, `ERROR`, `WARNING` |
| C | message | String | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | `æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿åé›†å®Œäº†: 15ä»¶` |
| D | function_name | String | é–¢æ•°å | `fetchMetricsHourly` |
| E | error | String | ã‚¨ãƒ©ãƒ¼è©³ç´°ï¼ˆã‚ã‚Œã°ï¼‰ | `API rate limit exceeded` |

### ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³

#### 1. æ–°è¦æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 
```typescript
// 1. APIã‹ã‚‰æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿å–å¾—
const threads = threadsApi.getThreads(100);

// 2. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
for (const thread of threads.data) {
  const existingRow = spreadsheetManager.findRowByThreadId(thread.id);
  
  if (existingRow === null) {
    // 3. æ–°è¦ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¿½åŠ 
    spreadsheetManager.appendRow([
      thread.id,
      thread.timestamp,
      thread.text,
      dataProcessor.countCharacters(thread.text),
      thread.media_type,
      thread.likes_count,
      thread.replies_count,
      thread.reposts_count,
      thread.impressions,
      dataProcessor.calculateEngagementRate(
        thread.likes_count,
        thread.replies_count,
        thread.reposts_count,
        thread.impressions
      ),
      new Date(),
      new Date()
    ]);
  } else {
    // 4. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ï¼ˆ12æ™‚é–“å¾Œã®ãƒ‡ãƒ¼ã‚¿å–å¾—æ™‚ãªã©ï¼‰
    spreadsheetManager.updateRow(existingRow, [...]);
  }
}
```

#### 2. æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿å–å¾—
```typescript
// 1. æœŸé–“æŒ‡å®šã§ãƒ‡ãƒ¼ã‚¿å–å¾—
const startDate = new Date(2024, 10, 1); // 2024å¹´11æœˆ1æ—¥
const endDate = new Date(2024, 10, 30); // 2024å¹´11æœˆ30æ—¥
const monthData = spreadsheetManager.getDataByDate(startDate, endDate);

// 2. ãƒ‡ãƒ¼ã‚¿åˆ†æ
const report = reportGenerator.generateMonthlyReport(2024, 11);

// 3. ãƒ¬ãƒãƒ¼ãƒˆä¿å­˜
spreadsheetManager.appendRow([
  'monthly_report',
  JSON.stringify(report),
  new Date()
]);
```

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜

### 1. èªè¨¼ãƒ»èªå¯

#### Webã‚¢ãƒ—ãƒªã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ‰€æœ‰è€…ï¼ˆ`USER_DEPLOYING`ï¼‰
- **ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™**: åŒ¿åã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼ˆ`ANYONE_ANONYMOUS`ï¼‰
- **ç†ç”±**: å€‹äººç”¨ãƒ„ãƒ¼ãƒ«ã®ãŸã‚ã€URLã‚’çŸ¥ã£ã¦ã„ã‚‹äººã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ååˆ†

**å¤‰æ›´æ–¹æ³•**:
```json
// appsscript.json
{
  "webapp": {
    "executeAs": "USER_DEPLOYING",
    "access": "ANYONE_ANONYMOUS"  // ã¾ãŸã¯ "MYSELF"ï¼ˆæœ¬äººã®ã¿ï¼‰
  }
}
```

### 2. APIã‚­ãƒ¼ã®å®‰å…¨ãªä¿ç®¡

#### PropertiesServiceã®ä½¿ç”¨
```typescript
// ä¿å­˜ï¼ˆæš—å·åŒ–ï¼‰
PropertiesService.getScriptProperties().setProperty('THREADS_API_KEY', apiKey);

// å–å¾—
const apiKey = PropertiesService.getScriptProperties().getProperty('THREADS_API_KEY');

// å‰Šé™¤
PropertiesService.getScriptProperties().deleteProperty('THREADS_API_KEY');
```

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç‰¹æ€§
- âœ… **ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ä¿å­˜**: Googleã®ã‚µãƒ¼ãƒãƒ¼ã§æš—å·åŒ–
- âœ… **GitHubã«å«ã¾ã‚Œãªã„**: ã‚³ãƒ¼ãƒ‰ã¨åˆ†é›¢
- âœ… **ãƒ–ãƒ©ã‚¦ã‚¶ã«ééœ²å‡º**: HTMLã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«è¡¨ç¤ºã•ã‚Œãªã„
- âœ… **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰**: ä»–ã®GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯

#### æ³¨æ„äº‹é …
- âŒ **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…±æœ‰ç¦æ­¢**: GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä»–è€…ã¨å…±æœ‰ã—ãªã„
- âš ï¸ **å®šæœŸçš„ãªãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**: 3-6ãƒ¶æœˆã”ã¨ã«APIã‚­ãƒ¼ã‚’æ›´æ–°
- ğŸ”’ **æ¼æ´©æ™‚ã®å¯¾å¿œ**: å³åº§ã«Threads Developer Consoleã§ç„¡åŠ¹åŒ–

### 3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

#### æ¨å¥¨è¨­å®š
- **å…±æœ‰è¨­å®š**: ã€Œãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹å…¨å“¡ï¼ˆé–²è¦§ã®ã¿ï¼‰ã€ã¾ãŸã¯ã€Œç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã€
- **ç·¨é›†æ¨©é™**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ‰€æœ‰è€…ã®ã¿
- **ç†ç”±**: ãƒ‡ãƒ¼ã‚¿ã®ä¸æ­£æ”¹ã–ã‚“é˜²æ­¢

#### ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹
```typescript
// ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹
const spreadsheet = SpreadsheetApp.openById(spreadsheetId);

// æ¨©é™ãƒã‚§ãƒƒã‚¯
if (!spreadsheet) {
  throw new Error('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“');
}
```

### 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ­ã‚°

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
function safeApiCall<T>(fn: () => T, fallback: T): T {
  try {
    return fn();
  } catch (error) {
    console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
    logError('APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼', error);
    return fallback;
  }
}
```

#### ãƒ­ã‚°è¨˜éŒ²
```typescript
function logError(message: string, error: any): void {
  const logSheet = SpreadsheetApp.openById(getSpreadsheetId()).getSheetByName('logs');
  logSheet.appendRow([
    new Date(),
    'ERROR',
    message,
    JSON.stringify(error)
  ]);
}
```

---

## ğŸ”„ ãƒãƒƒãƒå‡¦ç†ä»•æ§˜

### æ—¥æ¬¡ãƒãƒƒãƒï¼ˆæ¯æ—¥9:00å®Ÿè¡Œï¼‰

#### `runDailyAnalysis()`ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. è¨­å®šãƒã‚§ãƒƒã‚¯
   â”œâ”€ APIã‚­ãƒ¼ã®å­˜åœ¨ç¢ºèª
   â”œâ”€ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã®å­˜åœ¨ç¢ºèª
   â””â”€ ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯å‡¦ç†ä¸­æ–­

2. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±æ›´æ–°
   â”œâ”€ threadsApi.getUserProfile() å‘¼ã³å‡ºã—
   â”œâ”€ ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°å–å¾—
   â””â”€ profileã‚·ãƒ¼ãƒˆã«ä¿å­˜

3. æ–°è¦æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿å–å¾—
   â”œâ”€ threadsApi.getThreads(100) å‘¼ã³å‡ºã—
   â”œâ”€ éå»24æ™‚é–“ã®æŠ•ç¨¿ã‚’å¯¾è±¡
   â””â”€ postsã‚·ãƒ¼ãƒˆã«è¿½åŠ 

4. æ—¢å­˜æŠ•ç¨¿ã®ã‚¤ãƒ³ã‚µã‚¤ãƒˆæ›´æ–°
   â”œâ”€ 12æ™‚é–“å‰ã€24æ™‚é–“å‰ã€72æ™‚é–“å‰ã€7æ—¥å‰ã®æŠ•ç¨¿ã‚’æŠ½å‡º
   â”œâ”€ threadsApi.getThreadInsights(threadId) å‘¼ã³å‡ºã—
   â””â”€ postsã‚·ãƒ¼ãƒˆã‚’æ›´æ–°

5. å¹³å‡å€¤è¨ˆç®—
   â”œâ”€ dataProcessor.calculateAverages() å‘¼ã³å‡ºã—
   â”œâ”€ éå»30æ—¥åˆ†ã®å¹³å‡ã‚’è¨ˆç®—
   â””â”€ configã‚·ãƒ¼ãƒˆã«ä¿å­˜

6. ãƒ­ã‚°è¨˜éŒ²
   â”œâ”€ å‡¦ç†æ™‚é–“ã€å–å¾—ä»¶æ•°ã‚’è¨˜éŒ²
   â””â”€ logsã‚·ãƒ¼ãƒˆã«ä¿å­˜
```

#### å®Ÿè£…ä¾‹
```typescript
function runDailyAnalysis(): { success: boolean; message: string } {
  try {
    // 1. è¨­å®šãƒã‚§ãƒƒã‚¯
    const apiKey = getApiKey();
    const userId = getUserId();
    const spreadsheetId = getSpreadsheetId();
    
    if (!apiKey || !userId || !spreadsheetId) {
      throw new Error('è¨­å®šãŒä¸å®Œå…¨ã§ã™');
    }
    
    // 2. åˆæœŸåŒ–
    const api = new ThreadsApi(apiKey, userId);
    const manager = new SpreadsheetManager(spreadsheetId);
    const processor = new DataProcessor();
    
    // 3. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
    const profile = api.getUserProfile();
    manager.initializeSheet('profile');
    manager.appendRow([
      new Date(),
      profile.followers_count,
      profile.username,
      `https://threads.net/@${profile.username}`
    ]);
    
    // 4. æ–°è¦æŠ•ç¨¿å–å¾—
    const threads = api.getThreads(100);
    for (const thread of threads.data) {
      const existingRow = manager.findRowByThreadId(thread.id);
      if (existingRow === null) {
        manager.appendRow([
          thread.id,
          thread.timestamp,
          thread.text,
          processor.countCharacters(thread.text),
          thread.media_type,
          0, 0, 0, 0, 0, // åˆæœŸå€¤
          new Date(),
          new Date()
        ]);
      }
    }
    
    // 5. ã‚¤ãƒ³ã‚µã‚¤ãƒˆæ›´æ–°
    const now = new Date();
    const allData = manager.getAllData();
    
    for (let i = 1; i < allData.length; i++) {
      const postDate = new Date(allData[i][1]);
      const hoursSincePost = (now.getTime() - postDate.getTime()) / (1000 * 60 * 60);
      
      if (hoursSincePost >= 12 && hoursSincePost < 13) {
        const insights = api.getThreadInsights(allData[i][0]);
        manager.updateRow(i + 1, [
          allData[i][0],
          allData[i][1],
          allData[i][2],
          allData[i][3],
          allData[i][4],
          insights.likes_count,
          insights.replies_count,
          insights.reposts_count,
          insights.impressions,
          processor.calculateEngagementRate(
            insights.likes_count,
            insights.replies_count,
            insights.reposts_count,
            insights.impressions
          ),
          allData[i][10],
          new Date()
        ]);
      }
    }
    
    // 6. å¹³å‡å€¤è¨ˆç®—
    const averages = processor.calculateAverages(allData);
    setPropertySafely('avg_likes', averages.avgLikes.toString());
    setPropertySafely('avg_engagement_rate', averages.avgEngagementRate.toString());
    
    // 7. ãƒ­ã‚°è¨˜éŒ²
    logInfo('æ—¥æ¬¡åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸ');
    
    return { success: true, message: 'åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸ' };
    
  } catch (error) {
    logError('æ—¥æ¬¡åˆ†æã‚¨ãƒ©ãƒ¼', error);
    return { success: false, message: `ã‚¨ãƒ©ãƒ¼: ${error.message}` };
  }
}
```

### é€±æ¬¡ãƒãƒƒãƒï¼ˆæœˆæ›œ10:00å®Ÿè¡Œï¼‰

#### `generateWeeklyReport()`ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. æœŸé–“è¨­å®š
   â””â”€ å‰é€±ã®æœˆæ›œã€œæ—¥æ›œ

2. ãƒ‡ãƒ¼ã‚¿å–å¾—
   â””â”€ spreadsheetManager.getDataByDate() ã§1é€±é–“åˆ†å–å¾—

3. ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
   â”œâ”€ ç·æŠ•ç¨¿æ•°
   â”œâ”€ å¹³å‡ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡
   â”œâ”€ æœ€ã‚‚åå¿œãŒè‰¯ã‹ã£ãŸæŠ•ç¨¿
   â””â”€ ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼å¢—åŠ æ•°

4. ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   â””â”€ reportGenerator.sendReportEmail()
```

### æœˆæ¬¡ãƒãƒƒãƒï¼ˆæ¯æœˆ1æ—¥10:00å®Ÿè¡Œï¼‰

#### `generateMonthlyReport()`ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. æœŸé–“è¨­å®š
   â””â”€ å‰æœˆ1æ—¥ã€œæœ«æ—¥

2. ãƒ‡ãƒ¼ã‚¿å–å¾—
   â””â”€ spreadsheetManager.getDataByDate() ã§1ãƒ¶æœˆåˆ†å–å¾—

3. è©³ç´°åˆ†æ
   â”œâ”€ æœˆé–“ã‚µãƒãƒªãƒ¼
   â”œâ”€ äººæ°—æŠ•ç¨¿Top10
   â”œâ”€ æŠ•ç¨¿æ™‚é–“å¸¯åˆ†æ
   â””â”€ ãƒˆãƒ¬ãƒ³ãƒ‰æ¨ç§»

4. ãƒ¬ãƒãƒ¼ãƒˆä¿å­˜
   â””â”€ HTMLãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›
```

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### 1. é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd threads_post_analysis

# Node.jsä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# claspã§Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³
clasp login

# Google Apps Script APIã‚’æœ‰åŠ¹åŒ–
# https://script.google.com/home/usersettings
```

### 2. GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

```bash
# æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
clasp create --title "ThreadsæŠ•ç¨¿åˆ†æãƒ„ãƒ¼ãƒ«" --type standalone

# .clasp.jsonãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹
```

### 3. TypeScriptãƒ“ãƒ«ãƒ‰ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# TypeScriptã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
npm run build

# GASã«ãƒ—ãƒƒã‚·ãƒ¥
clasp push

# ã¾ãŸã¯ä¸€æ‹¬å®Ÿè¡Œ
npm run push
```

### 4. Webã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤

1. GASã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‹ã: `clasp open`
2. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã€Œç¨®é¡ã‚’é¸æŠã€â†’ã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã€ã‚’é¸æŠ
4. è¨­å®š:
   - **èª¬æ˜**: `åˆå›ãƒ‡ãƒ—ãƒ­ã‚¤`
   - **æ¬¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦å®Ÿè¡Œ**: `è‡ªåˆ†`
   - **ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼**: `å…¨å“¡`ï¼ˆã¾ãŸã¯ `è‡ªåˆ†ã®ã¿`ï¼‰
5. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
6. **ãƒ‡ãƒ—ãƒ­ã‚¤ID**ã¨**Webã‚¢ãƒ—ãƒªã®URL**ã‚’ã‚³ãƒ”ãƒ¼

### 5. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä½œæˆ

1. Google Sheetsã§æ–°ã—ã„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ
2. ã‚·ãƒ¼ãƒˆåã‚’ä»¥ä¸‹ã«å¤‰æ›´:
   - `posts`
   - `profile`
   - `config`
   - `logs`
3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‹ã‚‰IDã‚’ã‚³ãƒ”ãƒ¼:
   ```
   https://docs.google.com/spreadsheets/d/{ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID}/edit
   ```

### 6. Webã‚¢ãƒ—ãƒªã§åˆæœŸè¨­å®š

1. Webã‚¢ãƒ—ãƒªã®URLã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€Œè¨­å®šã€ã‚¿ãƒ–ã‚’é–‹ã
3. ä»¥ä¸‹ã‚’å…¥åŠ›:
   - **Threads API Key**: Threads Developer Consoleã§å–å¾—
   - **Threads User ID**: è‡ªåˆ†ã®Threadsãƒ¦ãƒ¼ã‚¶ãƒ¼ID
   - **Spreadsheet ID**: æ‰‹é †5ã§ã‚³ãƒ”ãƒ¼ã—ãŸID
4. å„ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

### 7. ãƒˆãƒªã‚¬ãƒ¼è¨­å®š

GASã‚¨ãƒ‡ã‚£ã‚¿ã§ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ:

```javascript
function setupAllTriggers() {
  // æ—¥æ¬¡ãƒãƒƒãƒï¼ˆæ¯æ—¥9:00ï¼‰
  TriggerManager.setupDailyTrigger('runDailyAnalysis', 9);
  
  // é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆï¼ˆæœˆæ›œ10:00ï¼‰
  TriggerManager.setupWeeklyTrigger('generateWeeklyReport', ScriptApp.WeekDay.MONDAY, 10);
  
  // æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆï¼ˆæ¯æœˆ1æ—¥10:00ï¼‰
  TriggerManager.setupMonthlyTrigger('generateMonthlyReport', 1, 10);
  
  console.log('å…¨ã¦ã®ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šã—ã¾ã—ãŸ');
}
```

### 8. å‹•ä½œç¢ºèª

1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ–ã§ã€Œåˆ†æã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. æ•°ç§’å¾Œã€ã€Œãƒ‡ãƒ¼ã‚¿ã€ã‚¿ãƒ–ã«æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

### æ‰‹å‹•ãƒ†ã‚¹ãƒˆé …ç›®

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ–ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ã‚¿ãƒ–ã§ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] è¨­å®šã‚¿ãƒ–ã§APIã‚­ãƒ¼ã‚’ä¿å­˜ã§ãã‚‹
- [ ] åˆ†æå®Ÿè¡Œãƒœã‚¿ãƒ³ãŒå‹•ä½œã™ã‚‹
- [ ] ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹
- [ ] ãƒã‚¤ãƒ©ã‚¤ãƒˆæ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- [ ] `runAnalysis()` ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹
- [ ] Threads APIã‹ã‚‰æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹
- [ ] ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå‹•ä½œã™ã‚‹
- [ ] ãƒˆãƒªã‚¬ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹

### GASã‚¨ãƒ‡ã‚£ã‚¿ã§ã®ãƒ†ã‚¹ãƒˆ

```javascript
// APIã‚­ãƒ¼ä¿å­˜ãƒ†ã‚¹ãƒˆ
function testSaveApiKey() {
  const result = saveApiKey('test_api_key_12345');
  console.log(result);
}

// ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ
function testGetThreads() {
  const api = new ThreadsApi(getApiKey(), getUserId());
  const threads = api.getThreads(10);
  console.log(threads);
}

// ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ›¸ãè¾¼ã¿ãƒ†ã‚¹ãƒˆ
function testSpreadsheetWrite() {
  const manager = new SpreadsheetManager(getSpreadsheetId());
  manager.initializeSheet('posts');
  manager.appendRow(['test_id', new Date(), 'ãƒ†ã‚¹ãƒˆæŠ•ç¨¿', 5, 'TEXT', 0, 0, 0, 0, 0, new Date(), new Date()]);
}
```

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä»•æ§˜

### å‡¦ç†æ™‚é–“ã®ç›®æ¨™

| å‡¦ç† | ç›®æ¨™æ™‚é–“ | å‚™è€ƒ |
|-----|---------|------|
| Webã‚¢ãƒ—ãƒªåˆå›è¡¨ç¤º | < 3ç§’ | HTMLãƒ­ãƒ¼ãƒ‰ï¼‹åˆæœŸãƒ‡ãƒ¼ã‚¿å–å¾— |
| ãƒ‡ãƒ¼ã‚¿ã‚¿ãƒ–è¡¨ç¤º | < 2ç§’ | 100ä»¶ã®ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º |
| åˆ†æå®Ÿè¡Œï¼ˆ100ä»¶ï¼‰ | < 30ç§’ | APIå‘¼ã³å‡ºã—ï¼‹ãƒ‡ãƒ¼ã‚¿ä¿å­˜ |
| æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ | < 60ç§’ | 1ãƒ¶æœˆåˆ†ï¼ˆæœ€å¤§3000ä»¶ï¼‰ã®åˆ†æ |

### æœ€é©åŒ–æ‰‹æ³•

#### 1. ãƒãƒƒãƒæ›¸ãè¾¼ã¿
```typescript
// æ‚ªã„ä¾‹ï¼ˆ1è¡Œãšã¤æ›¸ãè¾¼ã¿ï¼‰
for (const data of dataArray) {
  sheet.appendRow(data); // æ¯å›APIå‘¼ã³å‡ºã—
}

// è‰¯ã„ä¾‹ï¼ˆä¸€æ‹¬æ›¸ãè¾¼ã¿ï¼‰
const batchData = dataArray.map(d => [d.id, d.name, d.value]);
sheet.getRange(2, 1, batchData.length, batchData[0].length).setValues(batchData);
```

#### 2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨
```typescript
const cache = CacheService.getScriptCache();

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
let data = cache.get('follower_count');
if (!data) {
  // APIã‹ã‚‰å–å¾—
  data = api.getUserProfile().followers_count;
  // 1æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  cache.put('follower_count', data, 3600);
}
```

#### 3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œ
```typescript
private waitForRateLimit(): void {
  const lastCallTime = parseInt(CacheService.getScriptCache().get('last_api_call') || '0');
  const now = Date.now();
  const minInterval = 18000; // 18ç§’ï¼ˆ200ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“ï¼‰
  
  if (now - lastCallTime < minInterval) {
    Utilities.sleep(minInterval - (now - lastCallTime));
  }
  
  CacheService.getScriptCache().put('last_api_call', now.toString(), 3600);
}
```

---

## ğŸ“ é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

#### å‘½åè¦å‰‡
- **é–¢æ•°å**: ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆ`getUserProfile`, `calculateEngagementRate`ï¼‰
- **ã‚¯ãƒ©ã‚¹å**: ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆ`ThreadsApi`, `SpreadsheetManager`ï¼‰
- **å®šæ•°**: ã‚¢ãƒƒãƒ‘ãƒ¼ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ï¼ˆ`API_BASE_URL`, `MAX_RETRIES`ï¼‰
- **ãƒ•ã‚¡ã‚¤ãƒ«å**: ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆ`threadsApi.ts`, `dataProcessor.ts`ï¼‰

#### ã‚³ãƒ¡ãƒ³ãƒˆ
- æ—¥æœ¬èªã§è¨˜è¿°
- é–¢æ•°ã®ä¸Šã«èª¬æ˜ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¿…ãšè¨˜è¿°
- è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã«ã¯è¡Œå†…ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 

```typescript
/**
 * ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡ã‚’è¨ˆç®—ã™ã‚‹
 * @param likes ã„ã„ã­æ•°
 * @param replies ãƒªãƒ—ãƒ©ã‚¤æ•°
 * @param shares ã‚·ã‚§ã‚¢æ•°
 * @param impressions ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ•°
 * @returns ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡ï¼ˆ%ï¼‰
 */
function calculateEngagementRate(
  likes: number,
  replies: number,
  shares: number,
  impressions: number
): number {
  if (impressions === 0) return 0;
  
  // ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ = (ã„ã„ã­ + ãƒªãƒ—ãƒ©ã‚¤ + ã‚·ã‚§ã‚¢) / ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ Ã— 100
  const totalEngagement = likes + replies + shares;
  return (totalEngagement / impressions) * 100;
}
```

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- å¿…ãš `try-catch` ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã«
- ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã¯è©³ç´°ã«è¨˜éŒ²

```typescript
function safeOperation(): { success: boolean; message: string; data?: any } {
  try {
    // å‡¦ç†
    const result = performOperation();
    return { success: true, message: 'æˆåŠŸã—ã¾ã—ãŸ', data: result };
  } catch (error) {
    console.error('æ“ä½œã‚¨ãƒ©ãƒ¼:', error);
    logError('safeOperation', error);
    return { success: false, message: 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' };
  }
}
```

### Gité‹ç”¨

#### ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥
- `main`: æœ¬ç•ªç”¨ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ãªçŠ¶æ…‹ï¼‰
- `develop`: é–‹ç™ºç”¨ï¼ˆæ¬¡ã®ãƒªãƒªãƒ¼ã‚¹æº–å‚™ï¼‰
- `feature/*`: æ©Ÿèƒ½è¿½åŠ ç”¨
- `fix/*`: ãƒã‚°ä¿®æ­£ç”¨

#### ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
```
[ç¨®é¡] ç°¡æ½”ãªèª¬æ˜

è©³ç´°ãªèª¬æ˜ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
```

**ç¨®é¡**:
- `feat`: æ–°æ©Ÿèƒ½
- `fix`: ãƒã‚°ä¿®æ­£
- `docs`: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `style`: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- `refactor`: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- `test`: ãƒ†ã‚¹ãƒˆè¿½åŠ 
- `chore`: ãã®ä»–ï¼ˆãƒ“ãƒ«ãƒ‰è¨­å®šãªã©ï¼‰

**ä¾‹**:
```
feat: é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ©Ÿèƒ½ã‚’è¿½åŠ 

- ReportGeneratorã‚¯ãƒ©ã‚¹ã«generateWeeklyReport()ã‚’å®Ÿè£…
- é€±æ¬¡ãƒˆãƒªã‚¬ãƒ¼ã‚’è¿½åŠ 
- ãƒ¬ãƒãƒ¼ãƒˆHTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆ
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. ã€Œã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€

**åŸå› **: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDãŒé–“é•ã£ã¦ã„ã‚‹ã€ã¾ãŸã¯æ¨©é™ãŒãªã„

**è§£æ±ºæ–¹æ³•**:
1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‹ã‚‰IDã‚’å†ç¢ºèª
2. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å…±æœ‰è¨­å®šã§è‡ªåˆ†ãŒç·¨é›†æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹ç¢ºèª
3. GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒåŒã˜Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ç¢ºèª

#### 2. ã€ŒAPIå‘¼ã³å‡ºã—ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€

**åŸå› **: APIã‚­ãƒ¼ãŒç„¡åŠ¹ã€ã¾ãŸã¯ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã—ãŸ

**è§£æ±ºæ–¹æ³•**:
1. Threads Developer Consoleã§APIã‚­ãƒ¼ã®æœ‰åŠ¹æ€§ã‚’ç¢ºèª
2. APIã‚­ãƒ¼ã‚’å†ç”Ÿæˆã—ã¦è¨­å®šã—ç›´ã™
3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆ200ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“ï¼‰ã‚’è¶…ãˆã¦ã„ãªã„ã‹ç¢ºèª
4. 1æ™‚é–“å¾…ã£ã¦ã‹ã‚‰å†å®Ÿè¡Œ

#### 3. ã€Œãƒˆãƒªã‚¬ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œãªã„ã€

**åŸå› **: ãƒˆãƒªã‚¬ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
1. GASã‚¨ãƒ‡ã‚£ã‚¿ã§ã€Œãƒˆãƒªã‚¬ãƒ¼ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã
2. è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã‚’ç¢ºèª
3. å¿…è¦ã«å¿œã˜ã¦å‰Šé™¤ã—ã¦å†è¨­å®š
4. å®Ÿè¡Œãƒ­ã‚°ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

#### 4. ã€Œãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œãªã„ã€

**åŸå› **: ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¦ã„ã‚‹ã€ã¾ãŸã¯ã‚·ãƒ¼ãƒˆæ§‹é€ ãŒé–“é•ã£ã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•**:
1. GASã‚¨ãƒ‡ã‚£ã‚¿ã§ `runAnalysis()` ã‚’æ‰‹å‹•å®Ÿè¡Œã—ã¦ãƒ­ã‚°ã‚’ç¢ºèª
2. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã‚·ãƒ¼ãƒˆåãŒ `posts`, `profile`, `config`, `logs` ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
3. ãƒ‡ãƒ¼ã‚¿ã‚¿ãƒ–ã®JavaScriptã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Google Apps Scriptå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.google.com/apps-script)
- [Threads APIå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.facebook.com/docs/threads)
- [Google Sheets API](https://developers.google.com/sheets/api)

### ãƒ„ãƒ¼ãƒ«
- [claspï¼ˆGoogleå…¬å¼CLIï¼‰](https://github.com/google/clasp)
- [Apps Script Dashboard](https://script.google.com/home)
- [Threads Developer Console](https://developers.facebook.com/)

### ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [è¨­å®šæƒ…å ±ã®ä¿æŒæ–¹æ³•](./CONFIGURATION.md)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜](./security.md)
- [æ‰‹å‹•å®Ÿè¡Œã‚¬ã‚¤ãƒ‰](./MANUAL_EXECUTION.md)
- [å‹•çš„ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿](./DYNAMIC_DATA_LOADING.md)

---

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡Œã‚„è³ªå•ãŒã‚ã‚‹å ´åˆã¯ã€GitHubã®Issueã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

---

**æœ€çµ‚æ›´æ–°**: 2024å¹´11æœˆ27æ—¥
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ä½œæˆè€…**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒ¼ãƒ 
